# Workflow 优化应遵循静默成功原则，但保留用户决策权

## 触发条件（When to load）

当需要优化 workflow 的输出行为，特别是需要判断哪些输出可以精简或静默时。

## 问题现象（Symptom）

在优化 workflow 输出时，不确定应该：
- 哪些输出可以静默（成功/无问题时）
- 哪些输出必须保留（需要用户判断时）
- 如何平衡"静默成功"与"用户决策权"

## 根因（Root cause）

优化时容易过度精简，忽略了用户需要完整信息才能做出判断的场景。用户拥有真正的决定权，所有需要用户判断的输出必须完整保留。

## 解决方案（Fix）

**核心原则**：遵循 Linux 命令行设计哲学（没有消息就是好消息），但**用户决策权不可侵犯**。

**具体做法**：

1. **可以静默的输出**（成功/无问题/无匹配）：
   - 经验索引无匹配：静默
   - 推进判据满足：静默进入下一阶段
   - 文件写入成功：静默
   - 测试全部通过：静默
   - 经验治理无变更：静默
   - 质量准则无建议：静默

2. **必须完整保留的输出**（需要用户判断）：
   - **审查报告（audit）**：必须完整输出，用户需要根据报告自行判断
   - **固定 4 选项菜单**：必须保留，用户需要完整的判断选项（包括回退）
   - **候选展示**：必须完整展示，用户需要了解足够的候选信息才能做出判断

3. **精简但保留的输出**（减少冗余但保留关键信息）：
   - 阶段完成：正常时精简为一行，有阻塞项时详细说明
   - 经验治理：有变更时仅输出摘要，详细信息在文件中
   - 质量准则建议：有建议时输出完整表格，无建议时静默

**判断依据**：
- **是否需要用户判断**：需要判断 → 完整输出；不需要判断 → 可静默
- **是否影响决策**：影响决策 → 完整输出；不影响决策 → 可精简
- **是否预期行为**：预期行为（成功/通过） → 可静默；非预期行为（失败/阻塞） → 必须输出

## 校验方式（How to verify）

1. 检查所有需要用户判断的输出是否完整保留（audit 报告、菜单、候选展示）
2. 检查所有成功/无问题的输出是否已静默（经验索引、推进判据、文件写入、测试通过）
3. 验证用户能否基于完整信息做出判断
4. 验证静默输出不会影响用户对工作流状态的了解

## 关联指针（Pointers）

- `references/workflow-optimization-silent-success.md`：完整优化方案
- `.cursor/skills/flow-router/references/gate-protocol.md`：推进判据检查
- `.cursor/skills/audit/SKILL.md`：审查报告输出要求
- `.cursor/skills/flow-router/SKILL.md`：菜单输出要求

## Decision Shape（判断结构）

- **Decision being made**：判断哪些输出可以静默，哪些必须完整保留
- **Alternatives rejected**：
  - 审查报告精简为摘要（放弃，因为用户需要完整报告自行判断）
  - 菜单简化为 2-3 选项（放弃，因为用户需要完整的判断选项，包括回退）
  - 候选展示仅显示数量（放弃，因为用户需要了解足够的候选信息才能做出判断）
- **Discriminating signal**：
  - 是否需要用户判断（需要判断 → 完整输出；不需要判断 → 可静默）
  - 是否影响决策（影响决策 → 完整输出；不影响决策 → 可精简）
  - 是否预期行为（预期行为 → 可静默；非预期行为 → 必须输出）

## Judgment Capsule（认知蒸馏）

- **I used to think**：所有输出都可以精简，遵循"没有消息就是好消息"的原则，尽量静默所有成功/无问题的输出
- **Now I believe**：静默成功原则适用于非决策相关的输出，但所有需要用户判断的输出必须完整保留，因为只有用户拥有真正的决定权
- **Because the decisive variable is**：输出是否需要用户判断。需要用户判断的输出（如审查报告、菜单、候选展示）必须完整，因为用户需要基于完整信息做出决策；不需要用户判断的输出（如文件写入成功、测试通过、经验无匹配）可以静默，因为这是预期行为
