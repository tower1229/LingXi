# REQ-004: 计划实施Phase A（P0）：纪律底盘

| 属性     | 值               |
| -------- | ---------------- |
| 版本     | 1.0              |
| 状态     | 草稿             |
| 创建日期 | 2026-01-27       |
| 需求类型 | 工作流/知识工程   |
| 复杂度   | 中等             |

---

## 1. 概述

### 1.1 背景

根据远景纲领，Phase A（P0）的目标是：**把"魂控制魄"的机制做到足够强，让灵犀可被长期信任。**

当前灵犀已具备基础骨架（单入口、阶段路由、人工闸门、确认式沉淀），但以下机制尚需强化：

- **闸门协议不够清晰**：各阶段的"可推进判据"虽有定义，但执行时可能不够明确、不够可验证
- **沉淀过滤标准缺失**：缺乏"明显噪音"的过滤机制，可能导致低质量候选进入暂存，增加人工筛选成本
- **治理策略未完全落地**：合并/取代/升级的触发条件与流程虽有设计，但执行流程可能不够稳定
- **推进判据确认环节冗余**：用户选择 B（进入下一阶段）后，系统再次展示判据并要求确认，造成双重确认的冗余

### 1.2 问题描述

1. **闸门协议不够清晰**：
   - 各阶段的"可推进判据"在文档中有定义，但在实际执行时，AI 可能不够严格地检查这些判据
   - 缺少可验证的检查清单，导致"看起来可以推进"但实际遗漏关键项
   - 质量闸门的输出格式不够统一，用户可能不清楚"是否真的可以推进"

2. **沉淀过滤标准缺失**：
   - 当前依赖"人负责不滥"，但缺乏"明显噪音"的自动过滤机制
   - 可能导致临时调试记录、一次性错误、过于具体无复用价值的候选进入暂存
   - 增加人工筛选成本，分散对真正需要判断的候选的注意力

3. **治理策略未完全落地**：
   - 合并/取代的触发条件虽有设计，但执行流程可能不够稳定
   - 升级为规则的触发条件不够明确（何时从经验升级为 qs-* 规则）
   - 治理报告的格式与内容可能不够统一，影响可审计性

4. **推进判据确认环节冗余**：
   - 用户选择 B（进入下一阶段）后，系统再次展示判据并要求确认，造成双重确认
   - 用户已通过选择 B 表达了推进意图，再次确认是冗余的
   - 判据应该作为"告知"而非"再次确认"的环节

### 1.3 解决方案概述（不含技术实现细节）

本需求聚焦四个子任务，分别强化四个机制：

1. **强化闸门协议**：
   - 为每个阶段定义可验证的检查清单（checklist），确保"可推进判据"可执行
   - 统一质量闸门的输出格式，明确展示"已满足/未满足"的判据
   - 在 Skills 中固化闸门检查逻辑，确保每次阶段切换都严格执行

2. **沉淀过滤标准（Noise Filter）**：
   - 定义"明显噪音"的特征（可程序化过滤），如：临时调试记录、一次性错误、过于具体无复用价值
   - 在 experience-collector 中增加噪音过滤器，自动过滤明显不符合标准的候选
   - 边界模糊的候选仍进入暂存，由人判断（保护品味）
   - 被过滤的候选提供明确理由，支持人工复核

3. **治理策略落地**：
   - 明确合并/取代/升级的触发条件与执行流程
   - 统一治理报告的格式，确保可追溯、可回滚
   - 在 experience-curator 中固化治理逻辑，确保执行稳定

4. **移除冗余的推进判据确认环节**：
   - 用户选择 B 后，系统检查判据，满足则直接进入下一阶段（判据作为告知信息）
   - 判据不满足时，展示未满足项，提供选项（强制推进 / 回退 / 继续本阶段）
   - 移除"展示判据 + 再次确认"的冗余环节

---

## 2. 目标与指标

### 2.1 目标

| 编号 | 目标 | 优先级   |
| ---- | ---- | -------- |
| G1   | 每个阶段的"可推进判据"都有可验证的检查清单，AI 必须严格检查后才能推进 | 必须实现 |
| G2   | 沉淀过滤标准（Noise Filter）已定义，系统能自动过滤明显噪音，减少人工筛选成本 | 必须实现 |
| G3   | 治理策略的触发条件与执行流程明确且稳定，治理报告格式统一 | 必须实现 |
| G4   | 移除冗余的推进判据确认环节，用户选择 B 后满足判据则直接进入下一阶段 | 必须实现 |

### 2.2 非目标

- 不追求完全自动化的质量判断（边界模糊的候选仍由人判断，保护品味）
- 不改变现有的确认式沉淀机制（仍需要用户明确确认）
- 不引入复杂的机器学习模型来判断质量（使用可解释的规则和准则）
- 不实施"经验应用保证机制"（经验的应用依赖匹配机制，不在此需求范围内）

### 2.3 成功标准（必须可验证）

| 标准 | 描述 | 验证方式           |
| ---- | ---- | ------------------ |
| S1   | 每个阶段切换前，AI 必须输出格式化的"可推进判据检查清单"，明确展示已满足/未满足项 | 手工步骤：执行阶段切换，检查输出格式 |
| S2   | experience-collector 能自动过滤明显噪音候选（如：临时调试记录、一次性错误、过于具体无复用价值） | 手工步骤：创建明显噪音候选，检查是否被过滤，并验证理由说明 |
| S3   | experience-curator 的治理报告格式统一，包含变更理由、影响范围、回滚方式 | 手工步骤：触发治理，检查报告格式 |
| S4   | 治理策略的触发条件明确（如：经验数量达到阈值、发现明显重复等） | 文档审查：检查设计文档中的触发条件定义 |
| S5   | 用户选择 B 后，判据满足则直接进入下一阶段（判据作为告知，不要求再次确认） | 手工步骤：执行阶段切换，验证不再有双重确认 |

---

## 3. 用户故事（至少 1 条）

### US-1: 我希望阶段切换时有明确的检查清单

**作为** 使用灵犀的创造者
**我想要** 每次阶段切换前看到格式化的"可推进判据检查清单"，明确知道哪些已满足、哪些未满足
**以便** 我能做出更准确的决策，避免在不该推进时推进

**验收标准：**
- [ ] req → plan 切换前，输出检查清单，明确展示"Requirement 已写入"、"关键缺失项=0"等判据的状态
- [ ] plan → audit 切换前，输出检查清单，明确展示"plan 含 Tasks/Validation/Worklog"等判据的状态
- [ ] 其他阶段切换同理

### US-2: 我希望系统能帮我过滤明显噪音

**作为** 使用灵犀的创造者
**我想要** 系统自动过滤明显噪音候选（如：临时调试记录、一次性错误、过于具体无复用价值）
**以便** 我只需要关注真正需要判断的候选，减少噪音干扰，让判断力聚焦在边界模糊的地方

**验收标准：**
- [ ] experience-collector 能识别并过滤明显噪音候选
- [ ] 被过滤的候选有明确的理由说明（可解释、可复核）
- [ ] 边界模糊的候选仍进入暂存，由人判断（保护品味）

### US-3: 我希望治理策略的执行更稳定、更可审计

**作为** 使用灵犀的创造者
**我想要** 治理策略的触发条件明确，执行流程稳定，治理报告格式统一
**以便** 我能理解"为什么触发治理"、"治理做了什么"、"如何回滚"

**验收标准：**
- [ ] 治理策略的触发条件在文档中明确定义
- [ ] 治理报告格式统一，包含变更理由、影响范围、回滚方式
- [ ] 治理执行过程可追溯（有日志或记录）

### US-4: 我希望阶段切换时没有冗余的确认环节

**作为** 使用灵犀的创造者
**我想要** 选择 B（进入下一阶段）后，如果判据满足则直接进入，不需要再次确认
**以便** 减少不必要的交互，提高效率

**验收标准：**
- [ ] 用户选择 B 后，判据满足则直接进入下一阶段（判据作为告知信息展示）
- [ ] 判据不满足时，展示未满足项，提供选项（强制推进 / 回退 / 继续本阶段）
- [ ] 不再有"展示判据 + 再次确认"的冗余环节

---

## 4. 功能需求（中等+复杂度）

| 编号 | 需求描述 | 优先级   |
| ---- | -------- | -------- |
| F1   | 为每个阶段定义可验证的"可推进判据检查清单"，并在 Skills 中固化检查逻辑 | 必须实现 |
| F2   | 统一质量闸门的输出格式，明确展示"已满足/未满足"的判据 | 必须实现 |
| F3   | 定义"沉淀过滤标准（Noise Filter）"：明确"明显噪音"的特征（可程序化过滤） | 必须实现 |
| F4   | 在 experience-collector 中增加噪音过滤器，自动过滤明显噪音候选 | 必须实现 |
| F5   | 被过滤的候选提供明确理由，支持人工复核（如果认为被误判） | 必须实现 |
| F6   | 明确合并/取代/升级的触发条件与执行流程 | 必须实现 |
| F7   | 统一治理报告的格式，确保包含变更理由、影响范围、回滚方式 | 必须实现 |
| F8   | 在 experience-curator 中固化治理逻辑，确保执行稳定 | 必须实现 |
| F9   | 移除冗余的推进判据确认环节：用户选择 B 后，判据满足则直接进入下一阶段 | 必须实现 |
| F10  | 判据不满足时，展示未满足项，提供选项（强制推进 / 回退 / 继续本阶段） | 必须实现 |

---

## 5. 验收检查清单

- [ ] 每个阶段的"可推进判据检查清单"已定义并固化在对应 Skill 中
- [ ] 质量闸门输出格式统一，明确展示已满足/未满足项
- [ ] "沉淀过滤标准（Noise Filter）"已定义并文档化
- [ ] experience-collector 能自动过滤明显噪音候选
- [ ] 被过滤的候选有明确理由说明，支持人工复核
- [ ] 治理策略的触发条件已明确定义
- [ ] 治理报告格式统一，包含变更理由、影响范围、回滚方式
- [ ] experience-curator 的治理逻辑已固化，执行稳定
- [ ] 冗余的推进判据确认环节已移除，用户选择 B 后满足判据则直接进入下一阶段
- [ ] 判据不满足时，能正确展示未满足项并提供选项
- [ ] 所有变更已通过手工验证，符合成功标准

---

## 6. 附录（复杂需求）

### 6.1 外部参考

- [远景纲领：保护创造者的判断力、品味与责任感](../../docs/05-development/research/vision-analysis.md) - Phase A（P0）目标定义
- [工作流生命周期设计](../../docs/02-design/workflow-lifecycle.md) - 质量闸门定义
- [经验治理机制设计](../../docs/02-design/experience-governance.md) - 治理策略设计

### 6.2 关键决策记录

| 决策点 | 备选方案 | 最终选择 | 理由 |
| ------ | -------- | -------- | ---- |
| 沉淀过滤的自动化程度 | A: 完全自动化 / B: 只过滤明显噪音，边界模糊由人判断 | B | 保护品味：只过滤明显噪音，边界模糊的候选仍由人判断 |
| 治理策略的触发方式 | A: 固定阈值 / B: 每次沉淀后触发 / C: 混合 | C | 根据场景选择，但触发条件需明确 |
| 推进判据确认方式 | A: 展示判据 + 再次确认 / B: 判据满足则直接进入（判据作为告知） | B | 用户已通过选择 B 表达推进意图，再次确认是冗余的 |
