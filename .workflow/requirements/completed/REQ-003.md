# REQ-003: Workflow 初始化 - 项目上下文沉淀

| 属性     | 值               |
| -------- | ---------------- |
| 版本     | 1.0              |
| 状态     | 草稿             |
| 创建日期 | 2026-01-12       |
| 需求类型 | 工作流/知识工程   |
| 复杂度   | 中等             |

---

## 1. 概述

### 1.1 背景

当 cursor-workflow 被用于一个现有项目时，需要快速建立项目上下文，让 workflow 能够理解项目的技术栈、常用模式、开发规则、业务流程等。这些信息应该被沉淀到经验库（`.workflow/context/experience/`）或规则（`.cursor/rules/qs-*`）中，以便后续工作流能够快速融入项目环境。

目前 workflow 已经具备：
- 经验沉淀机制（experience-depositor、experience-curator）
- 服务上下文加载机制（service-loader）
- 规则创建机制（rules-creator）

但缺少：
1. **Business Context 模板**：用于沉淀业务流程、业务规则、协作上下文等业务相关信息
2. **Init 命令**：用于快速启动项目初始化流程，引导式收集项目信息并沉淀到合适的载体

### 1.2 问题描述

1. **缺少业务上下文模板**：虽然 `.workflow/context/business/` 目录已存在，但没有明确的模板规范，不知道如何结构化地沉淀业务相关信息。
2. **缺少初始化入口**：新项目接入 workflow 时，需要手动执行多个步骤（理解项目、沉淀知识、创建规则），没有统一的初始化命令来引导这个过程。
3. **设计缺口需要补齐**：business context 模板和 init 命令的设计需要在本次需求中完成。

### 1.3 解决方案概述（不含技术实现细节）

1. **定义 Business Context 模板**：
   - 在 `docs/02-design/` 中定义 business context 的模板结构
   - 模板应包含：业务定位、业务边界、关键流程、业务规则、协作上下文、常见问题等章节
   - 参考 `service-loader` 的设计原则（先索引后细节、Just-in-Time、可验证）

2. **创建独立的 `/init` 命令**：
   - 创建 `.cursor/commands/init.md` 作为独立的初始化命令（与高频的 `/flow` 命令分离）
   - 命令应引导式收集项目信息（技术栈、业务领域、开发规范等）
   - 自动激活 `service-loader` 和 `experience-depositor` 相关流程
   - 生成初始化的经验文档和规则建议
   - 输出初始化报告

3. **执行项目初始化流程**：
   - 分析当前项目（技术栈、模式、规则、业务流程）
   - 生成经验候选（EXP-CANDIDATE）
   - 生成业务上下文文档（`.workflow/context/business/`）
   - 生成服务上下文文档（`.workflow/context/tech/services/`，如适用）

---

## 2. 目标与指标

### 2.1 目标

| 编号 | 目标 | 优先级   |
| ---- | ---- | -------- |
| G1   | 定义 Business Context 模板规范，支持结构化沉淀业务相关信息 | 必须实现 |
| G2   | 创建独立的 `/init` 命令，提供项目初始化引导流程 | 必须实现 |
| G3   | 通过执行初始化流程，验证经验沉淀机制（EXP-CANDIDATE、experience-collector、experience-depositor、experience-curator、experience-index）是否正常运行 | 必须实现 |

### 2.2 非目标

- 不实现自动化的项目分析（需要人工参与和确认）
- 不强制要求所有项目都必须执行初始化（可选流程）
- 不实现复杂的项目结构自动识别（基于引导式收集）

### 2.3 成功标准（必须可验证）

| 标准 | 描述 | 验证方式           |
| ---- | ---- | ------------------ |
| S1   | Business Context 模板已定义，文档清晰说明如何使用 | 检查 `docs/02-design/` 中的模板文档 |
| S2   | `/init` 命令已创建，能够引导式收集项目信息 | 执行 `/init` 命令，验证引导流程 |
| S3   | 初始化流程能够生成至少 1 个业务上下文文档示例 | 检查 `.workflow/context/business/` 目录 |
| S4   | 经验沉淀机制验证：EXP-CANDIDATE 被输出、experience-collector 收集、experience-depositor 可触发 | 检查 `.workflow/context/session/pending-compounding-candidates.json` 和执行沉淀流程 |
| S5   | experience-curator 在写入新经验后自动触发治理 | 执行沉淀后检查是否输出治理报告和质量准则建议 |
| S6   | experience-index 在进入各阶段前能够匹配并提醒相关经验 | 在 req/plan/work 阶段检查是否有经验提醒 |

---

## 3. 用户故事（至少 1 条）

### US-1: 我希望快速初始化 workflow 到新项目

**作为** 使用 cursor-workflow 的工程师
**我想要** 执行 `/init` 命令来引导式初始化项目上下文
**以便** 快速将项目的技术栈、开发规则、业务流程等信息沉淀到经验库和规则中，让后续工作流能够快速融入项目环境

**验收标准：**
- [ ] `/init` 命令能够引导式收集项目信息
- [ ] 能够生成业务上下文文档和服务上下文文档
- [ ] 能够生成经验候选并支持沉淀确认

### US-2: 我希望有明确的模板来沉淀业务上下文

**作为** 需要沉淀业务知识的工程师
**我想要** 使用标准的 Business Context 模板来结构化记录业务信息
**以便** 业务知识能够被系统化地沉淀和复用

**验收标准：**
- [ ] Business Context 模板已定义并文档化
- [ ] 模板包含必要的章节（业务定位、边界、流程、规则、协作、FAQ）
- [ ] 能够基于模板创建业务上下文文档

---

## 4. 功能需求（中等+复杂度）

| 编号 | 需求描述 | 优先级   |
| ---- | -------- | -------- |
| F1   | 定义 Business Context 模板结构，包含业务定位、边界、流程、规则、协作、FAQ 等章节 | 必须实现 |
| F2   | 在 `docs/02-design/` 中创建 Business Context 模板文档（或更新 `data-models.md`） | 必须实现 |
| F3   | 创建独立的 `/init` 命令文件（`.cursor/commands/init.md`） | 必须实现 |
| F4   | `/init` 命令能够引导式收集项目信息（技术栈、业务领域、开发规范等） | 必须实现 |
| F5   | `/init` 命令能够自动激活 `service-loader` 和 `experience-depositor` 相关流程 | 必须实现 |
| F6   | `/init` 命令能够生成初始化的经验文档和规则建议 | 必须实现 |
| F7   | `/init` 命令能够输出初始化报告 | 必须实现 |
| F8   | 执行项目初始化流程，分析当前项目并生成业务上下文文档 | 必须实现 |
| F9   | 在初始化过程中输出 EXP-CANDIDATE，验证 experience-collector 收集机制 | 必须实现 |
| F10  | 验证 experience-depositor 能够正确展示候选、执行沉淀分流、写入经验 | 必须实现 |
| F11  | 验证 experience-curator 在写入新经验后自动触发治理（合并/取代、更新 INDEX、质量准则建议） | 必须实现 |
| F12  | 验证 experience-index 在进入各阶段前能够匹配并提醒相关经验 | 必须实现 |

---

## 5. 验收检查清单

- [ ] Business Context 模板已定义并文档化
- [ ] `/init` 命令已创建，能够执行引导式初始化流程
- [ ] 初始化流程能够生成至少 1 个业务上下文文档示例
- [ ] 初始化流程能够生成至少 1 个服务上下文文档示例（如适用）
- [ ] EXP-CANDIDATE 在 work 阶段被正确输出
- [ ] experience-collector 能够收集并暂存候选到 `.workflow/context/session/pending-compounding-candidates.json`
- [ ] experience-depositor 能够正确展示候选、执行沉淀分流、写入经验
- [ ] experience-curator 在写入新经验后自动触发治理，输出治理报告和质量准则建议
- [ ] experience-index 在进入各阶段前能够匹配并提醒相关经验
- [ ] 所有设计缺口（Business Context 模板、init 命令）已补齐

---

## 6. 附录（复杂需求）

### 6.1 外部参考

- [Cursor Agent Skills](https://cursor.com/cn/docs/context/skills) - Cursor Nightly 的 Skills 机制
- [service-loader SKILL.md](.cursor/skills/service-loader/SKILL.md) - 服务上下文加载机制参考
- [experience-depositor SKILL.md](.cursor/skills/experience-depositor/SKILL.md) - 经验沉淀机制参考
- [remember.md](.cursor/commands/remember.md) - 独立命令设计参考

### 6.2 关键决策记录

| 决策点 | 备选方案 | 最终选择 | 理由 |
| ------ | -------- | -------- | ---- |
| Init 命令设计 | A) 扩展 `/flow` 命令支持 `/flow init` 子命令<br>B) 创建独立的 `/init` 命令 | B | 低频命令与高频命令分离，降低用户心智负担 |
| Business Context 模板位置 | A) 更新 `docs/02-design/data-models.md`<br>B) 新建 `docs/02-design/business-context-template.md` | 待 plan 阶段决定 | 需要评估现有文档结构 |
