# REQ-005: Phase B（P0）：价值取向捕获（可行性与实施方案）

| 属性     | 值             |
| -------- | -------------- |
| 版本     | 1.0            |
| 状态     | 草稿           |
| 创建日期 | 2026-01-14     |
| 需求类型 | 工作流/知识工程 |
| 复杂度   | 中等           |

---

## 1. 概述

### 1.1 背景

远景文档中 Phase B（P0）目标是：从“知道魄做了什么”升级为“知道魂为什么这样引导魄”：

- **显式捕获取舍依据**：trade-off、风险接受、拒绝了什么
- **业务语义抽象**：把业务边界/规则从需求中抽取为长期上下文，让魂的引导更精准

当前已在 Phase A（P0）建立“纪律底盘”（闸门协议、沉淀过滤、治理策略、静默成功与人工闸门）。但在实际执行中，“为什么这样做”的价值取向通常散落在对话与临时判断里，难以复用与审计。

### 1.2 问题描述

1. **取舍依据丢失**：plan/audit/work/review 中出现 trade-off 与风险接受，但最终产物往往只保留“做了什么”，缺少“为什么这么取舍”。
2. **拒绝方案不可追溯**：Alternatives rejected 没有稳定落点，后续很难复盘“当时为什么不选 B”。
3. **业务语义难复用**：需求里包含业务边界/规则，但缺少抽象与沉淀的固定形态（容易变成一次性项目笔记）。
4. **与现有机制未闭环**：即使产生了价值取向信息，也不一定能进入经验候选或长期上下文（缺少触发与最小结构）。

### 1.3 解决方案概述（不含技术实现细节）

围绕两类资产建立“可捕获、可沉淀、可治理、可加载”的最小机制，并新增“候选全量回放”机制，提升价值判断的即时性：

1. **价值取向捕获（Value Orientation Capture）**
   - 在 req/plan/audit/work/review 阶段，引导输出结构化的“取舍记录”（Trade-off Record），至少包含：决策点、备选方案、拒绝理由、接受的风险、影响范围与回滚线索。
   - 该记录可作为 EXP-CANDIDATE 的高质量输入（Decision Shape / Judgment Capsule 的上游素材），减少“沉淀时补写”的成本。

2. **业务语义抽象（Business Semantics Abstraction）**
   - 在 req/plan 阶段，把“业务边界/规则/术语”抽取为稳定条目（Semantics Capsule），以指针方式写入长期上下文（候选形态），避免污染经验库。
   - 明确“什么应写入经验（判断资产）/什么应写入业务上下文（语义资产）/什么仅留 session（过程记录）”。

3. **候选全量回放（Full Candidate Replay at Phase Start）**
   - **每个阶段开始前**，若上一阶段产生了通过低质量校验（噪音过滤 + 成长过滤器）的候选，则**全量展示**给用户，辅助即时价值判断。
   - 展示仅发生在“候选暂存区”，不等于写入经验；写入 `.workflow/context/experience/` 仍必须走 `/flow 沉淀 ...` 的确认式闸门。

---

## 2. 目标与指标

### 2.1 目标

| 编号 | 目标 | 优先级 |
|---|---|---|
| G1 | 在关键决策发生时，能**显式捕获取舍依据**（含 alternatives rejected 与风险接受），并能被后续沉淀复用 | 必须实现 |
| G2 | 能从需求中抽取并固化“业务语义”（边界/规则/术语），形成可被后续需求复用的长期上下文形态 | 必须实现 |
| G3 | 与现有 Phase A 机制兼容：不破坏单入口/人工闸门/静默成功/确认式沉淀/噪音过滤/治理策略 | 必须实现 |
| G4 | 候选经验更即时：在进入新阶段前，全量回放上一阶段通过过滤的候选，减少遗忘带来的价值判断失真 | 必须实现 |

### 2.2 非目标

- 不引入“自动替用户做价值判断”的机制（价值取向来自用户与团队约束的显式表达）
- 不追求一次性覆盖所有业务语义（只要形成可扩展的条目化沉淀形态）
- 不新增入口命令（保持 `/flow` 单入口）

### 2.3 成功标准（必须可验证）

| 标准 | 描述 | 验证方式 |
|---|---|---|
| S1 | 当出现关键取舍时，阶段输出中包含结构化的 Trade-off Record（可被沉淀复用） | 手工：在 plan/audit/work 中制造一个取舍点，检查输出结构 |
| S2 | 至少能抽取 3 条业务语义条目（边界/规则/术语）并形成稳定的“语义资产”输出形态（指针优先） | 手工：在 req 阶段抽取条目并检查可复用性 |
| S3 | 经验沉淀仍遵循确认式：未明确 `/flow 沉淀` 不写入 `.workflow/context/experience/` | 手工：观察行为是否越权 |
| S4 | 在进入任一阶段前，若上一阶段存在通过低质量校验的候选，则**全量展示**给用户（至少包含 trigger/decision/signal/solution/verify/pointers 等摘要字段） | 手工：制造 2 条候选并进入下一阶段，检查是否全量回放 |
| S5 | 不引入越权写入：即使全量展示候选，也不会自动写入 experience（仍需 `/flow 沉淀`） | 手工：观察是否出现未经确认的写入 |

---

## 3. 用户故事（至少 1 条）

### US-1：我希望每次关键取舍都能被复用与审计

**作为** 使用灵犀推进需求的创造者  
**我想要** 在出现 trade-off/风险接受/拒绝方案时，有稳定且最小的结构化记录  
**以便** 之后遇到类似情境能快速复盘“为什么这么做”，并在沉淀时无需再补写

**验收标准：**
- [ ] 在 plan/audit/work 任一阶段出现关键取舍时，输出 Trade-off Record（含 alternatives rejected 与风险接受）
- [ ] 该记录可以被直接转写为 EXP-CANDIDATE（或作为其输入），并通过噪音过滤器

### US-2：我希望业务边界与规则能沉淀为长期上下文

**作为** 需要长期维护同一业务系统的创造者  
**我想要** 将需求中的业务边界/规则/术语抽取为条目化语义资产  
**以便** 后续需求更快、更一致，减少反复解释与误解

**验收标准：**
- [ ] req 阶段至少抽取 3 条语义条目（边界/规则/术语），并以可复用形态输出
- [ ] 条目包含必要的指针（文档/代码/配置）以支撑后续定位

---

## 4. 功能需求（中等+复杂度）

| 编号 | 需求描述 | 优先级 |
|---|---|---|
| F1 | 定义最小“Trade-off Record”结构（字段与示例），用于捕获取舍依据 | 必须实现 |
| F2 | 在 req/plan/audit/work/review 的指引中加入“何时应输出 Trade-off Record / 如何保持精简（指针优先）” | 必须实现 |
| F3 | 定义最小“Semantics Capsule”结构（边界/规则/术语条目化），并规定写入位置（长期上下文 vs 经验） | 必须实现 |
| F4 | 保持与 Phase A 的静默成功、人工闸门、确认式沉淀、噪音过滤、治理策略兼容 | 必须实现 |
| F5 | 在“阶段开始前”增加候选回放：全量展示上一阶段通过过滤的候选（更即时，降低遗忘） | 必须实现 |
| F6 | 定义验证清单：覆盖 S1-S5 的手工验证步骤 | 必须实现 |

---

## 5. 验收检查清单

- [ ] Trade-off Record 结构已定义，并可在阶段输出中被触发
- [ ] Semantics Capsule 结构已定义，并能形成指针化长期上下文形态
- [ ] 进入任一阶段前，全量回放上一阶段通过低质量校验的候选（若存在）
- [ ] 不新增入口命令，仍使用 `/flow`
- [ ] 不越权写入 experience（仍需 `/flow 沉淀` 明确确认）
- [ ] 手工验证步骤覆盖 S1-S5

---

## 6. 附录

### 6.1 外部参考

- [远景纲领：Phase B（P0）价值取向捕获](../../../docs/05-development/research/vision-analysis.md)（参考文档，非 workflow 核心依赖）

### 6.2 关键决策记录

| 决策点 | 备选方案 | 最终选择 | 理由 |
|---|---|---|---|
| 价值取向承载位置 | A: 全部写入 experience / B: 语义与判断分离（不同承载） | B | 语义资产与判断资产生命周期与治理方式不同，混写会污染经验库与触发误加载 |

