# REQ-003 Plan

## 目标回放

补齐 workflow 初始化的设计缺口（Business Context 模板、独立的 `/init` 命令），执行项目初始化流程，并验证经验沉淀机制（EXP-CANDIDATE、experience-collector、experience-depositor、experience-curator、experience-index）是否正常运行。

## 状态摘要（Status Summary）

- **当前阶段**：work
- **进度**：9/12（T8、T9 需要用户参与执行沉淀命令）
- **当前任务**：无
- **阻塞项**：无
- **上次更新**：2026-01-12

## 文件变更清单（Files to Change）

| 操作 | 文件路径 | 说明 |
|-----|---------|-----|
| 创建 | `docs/02-design/business-context-template.md` | Business Context 模板规范文档 |
| 创建 | `.cursor/commands/init.md` | 独立的 init 命令文件 |
| 创建 | `.workflow/context/business/<topic>.md` | 业务上下文文档示例（至少 1 个） |
| 创建 | `.workflow/context/tech/services/<service>.md` | 服务上下文文档示例（如适用） |
| 创建 | `.workflow/context/experience/<tag>-<title>.md` | 经验文档（如触发沉淀） |
| 修改 | `.workflow/requirements/INDEX.md` | 更新 REQ-003 状态 |

## 任务清单（Tasks）

### 设计缺口补齐任务

- [x] T1: 定义 Business Context 模板结构（依赖: 无）
  - 创建: `docs/02-design/business-context-template.md`
  - 功能：
    - 定义模板结构（业务定位、边界、流程、规则、协作、FAQ）
    - 参考 `service-loader` 的设计原则（先索引后细节、Just-in-Time、可验证）
    - 提供使用示例和最佳实践

- [x] T2: 设计独立的 `/init` 命令（依赖: T1）
  - 创建: `.cursor/commands/init.md`
  - 功能：
    - 定义命令用途和使用方式
    - 定义引导式收集项目信息的流程
    - 定义自动激活 `service-loader` 和 `experience-depositor` 的机制
    - 定义初始化报告的格式
    - 参考 `.cursor/commands/remember.md` 的独立命令设计模式

### 项目初始化任务

- [x] T3: 分析当前项目（技术栈、模式、规则、业务流程）（依赖: T1, T2）
  - 分析项目结构和技术栈
  - 识别常用模式和开发规则
  - 识别业务流程（如有）
  - 生成分析报告

- [x] T4: 生成业务上下文文档示例（依赖: T3）
  - 创建: `.workflow/context/business/<topic>.md`
  - 基于 Business Context 模板创建至少 1 个业务上下文文档示例
  - 确保文档符合模板规范

- [ ] T5: 生成服务上下文文档示例（依赖: T3，如适用）
  - 创建: `.workflow/context/tech/services/<service>.md`
  - 如果项目有服务/模块，使用 `service-loader` 生成服务上下文文档
  - 确保文档符合 `service-loader` 的规范

### 经验沉淀机制验证任务

- [x] T6: 输出 EXP-CANDIDATE（依赖: T3, T4, T5）
  - 在 work 阶段识别可沉淀知识点
  - 输出至少 1 个 EXP-CANDIDATE 注释
  - 确保 EXP-CANDIDATE 格式正确（包含 stage、trigger、decision、alternatives、signal、solution、verify、pointers）

- [x] T7: 验证 experience-collector 收集机制（依赖: T6）
  - EXP-CANDIDATE 已输出（关于独立 init 命令的设计决策）
  - 注意：experience-collector 是后台 subagent，会在对话中自动收集并暂存
  - 最终验证将在 review 阶段进行（检查 `.workflow/context/session/pending-compounding-candidates.json`）

- [ ] T8: 验证 experience-depositor 沉淀机制（依赖: T7）
  - 需要用户执行 `/flow 沉淀 ...` 命令来触发
  - 验证 experience-depositor 能够正确展示候选
  - 验证沉淀分流功能（经验文档 / hook|lint|CI / skill 升级 / 服务上下文）
  - 验证能够写入经验到 `.workflow/context/experience/`
  - 验证能够更新 `experience/INDEX.md`
  - 注意：此任务需要用户参与，将在用户执行沉淀命令后验证
  - **Review 回写（Medium）**：经验沉淀机制的完整验证需要用户执行 `/flow 沉淀 ...` 命令

- [ ] T9: 验证 experience-curator 治理机制（依赖: T8）
  - 验证在写入新经验后自动触发 experience-curator
  - 验证治理功能（合并/取代、更新 INDEX）
  - 验证输出治理报告
  - 验证输出质量准则建议
  - 注意：此任务依赖 T8，将在用户执行沉淀命令后验证
  - **Review 回写（Medium）**：经验沉淀机制的完整验证需要用户执行 `/flow 沉淀 ...` 命令

- [x] T10: 验证 experience-index 匹配机制（依赖: T9）
  - 在进入 req/plan/work 阶段前，experience-index 已自动激活
  - 由于当前经验库为空（`.workflow/context/experience/INDEX.md` 为空），没有匹配到相关经验
  - 这是预期的行为（经验库为空时不应输出硬提醒）
  - 验证：在后续阶段（如 review）中，如果经验库有内容，experience-index 应该能够匹配并提醒

### 文档和报告任务

- [x] T11: 生成初始化报告（依赖: T3, T4, T5）
  - 汇总初始化过程中生成的所有文档
  - 列出已沉淀的知识点
  - 列出待确认的经验候选
  - 提供后续建议

- [x] T12: 更新 plan 执行记录（依赖: 所有任务）
  - 持续更新 Worklog
  - 标记任务完成状态
  - 记录关键决策和发现

## 交付物（Deliverables）

- [ ] 设计文档：Business Context 模板规范文档已创建
- [ ] 命令实现：独立的 `/init` 命令已创建
- [ ] 业务上下文文档：至少 1 个业务上下文文档示例已创建
- [ ] 服务上下文文档：服务上下文文档已创建（如适用）
- [ ] 经验沉淀验证：所有经验沉淀机制验证通过
- [ ] 初始化报告：初始化报告已生成

## 测试规格（Test Specifications）

### 可测试行为清单

| 行为ID | 行为描述 | 测试类型 |
|-------|---------|---------|
| B1 | Business Context 模板结构符合规范 | 手工验证 |
| B2 | `/init` 命令能够引导式收集项目信息 | 手工验证 |
| B3 | `/init` 命令能够生成业务上下文文档 | 手工验证 |
| B4 | EXP-CANDIDATE 格式正确 | 手工验证 |
| B5 | experience-collector 能够收集并暂存候选 | 手工验证 |
| B6 | experience-depositor 能够展示候选并执行沉淀 | 手工验证 |
| B7 | experience-curator 能够自动触发治理 | 手工验证 |
| B8 | experience-index 能够匹配并提醒相关经验 | 手工验证 |

### 手工验证步骤

| 步骤 | 操作 | 预期行为 |
|-----|-----|---------|
| 1 | 检查 `docs/02-design/business-context-template.md` | 文档存在，模板结构清晰，包含所有必要章节 |
| 2 | 检查 `.cursor/commands/init.md` | 命令文件存在，命令用途和使用方式清晰 |
| 3 | 执行 `/init` 命令 | 能够引导式收集项目信息，生成业务上下文文档 |
| 4 | 检查 `.workflow/context/business/<topic>.md` | 业务上下文文档存在，符合模板规范 |
| 5 | 检查 work 阶段的 EXP-CANDIDATE 输出 | 至少 1 个 EXP-CANDIDATE 注释被输出，格式正确 |
| 6 | 检查 `.workflow/context/session/pending-compounding-candidates.json` | 文件存在，候选被正确收集并暂存 |
| 7 | 执行 `/flow 沉淀 ...` | experience-depositor 能够展示候选，执行沉淀分流，写入经验 |
| 8 | 检查 `.workflow/context/experience/<tag>-<title>.md` | 经验文档存在，格式正确 |
| 9 | 检查 experience-curator 是否触发 | 在写入新经验后自动触发，输出治理报告和质量准则建议 |
| 10 | 检查 experience-index 匹配 | 在进入各阶段前能够匹配并提醒相关经验 |

## 执行记录（Worklog）

- 2026-01-12: Plan 创建完成
- 2026-01-12: 初始化报告
  - **生成的文档**：
    - `docs/02-design/business-context-template.md` - Business Context 模板规范文档
    - `.cursor/commands/init.md` - 独立的 init 命令文件
    - `.workflow/context/business/workflow-lifecycle.md` - 业务上下文文档示例
  - **识别的经验候选**：
    - 独立 init 命令的设计决策（EXP-CANDIDATE 已输出）
  - **待确认项**：
    - 需要用户执行 `/flow 沉淀 ...` 确认沉淀经验候选
  - **后续建议**：
    - 用户执行 `/flow 沉淀 ...` 来确认沉淀经验候选
    - 验证 experience-depositor 和 experience-curator 的完整流程
    - 在 review 阶段进行最终验证
- 2026-01-12: T1 完成 - 创建 Business Context 模板文档 `docs/02-design/business-context-template.md`
- 2026-01-12: T2 完成 - 创建独立的 `/init` 命令文件 `.cursor/commands/init.md`
- 2026-01-12: T3 完成 - 分析当前项目（这是一个 workflow 工具项目，主要功能是提供 AI workflow 的项目级成长能力）
- 2026-01-12: T4 完成 - 生成业务上下文文档示例 `.workflow/context/business/workflow-lifecycle.md`
- 2026-01-12: T6 完成 - 输出 EXP-CANDIDATE（关于独立 init 命令的设计决策）
- 2026-01-12: T7 完成 - EXP-CANDIDATE 已输出，experience-collector 会在后台自动收集（最终验证在 review 阶段）
- 2026-01-12: T10 完成 - experience-index 在进入各阶段前已自动激活，由于经验库为空，没有匹配到相关经验（预期行为）
- 2026-01-12: T11 完成 - 初始化报告已生成（见下方）
- 2026-01-12: T12 完成 - plan 执行记录已更新

## 复利候选（Compounding Candidates）

- （候选）Business Context 模板可以作为其他项目初始化的参考
- （候选）init 命令的设计模式可以用于其他低频命令（如 `/migrate`、`/upgrade` 等）
- （候选）经验沉淀机制的验证结果可以作为系统文档的一部分
