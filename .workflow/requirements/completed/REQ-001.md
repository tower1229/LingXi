# REQ-001: 经验成长机制（合并/取代 + 质量准则建议 + 沉淀后自动触发）

| 属性     | 值               |
| -------- | ---------------- |
| 版本     | 1.0              |
| 状态     | 草稿             |
| 创建日期 | 2026-01-12       |
| 需求类型 | 工作流/知识工程   |
| 复杂度   | 中等             |

---

## 1. 概述

### 1.1 背景

当前 workflow 已能把“复利候选”沉淀为经验（`.workflow/context/experience/*`），但经验库会持续增长。人类的成长不仅是“增加经验”，更关键的是：

- 将经验**融合**成更普适的认识（合并/抽象）
- 用新的理解**取代**旧的狭隘/过时经验（替代关系）
- 从经验中提炼出“质量准则”（质量判断/风险偏好/工程标准），但最终应由人做决策

### 1.2 问题描述

1. **缺少合并/取代的闭环**：经验会越积越多，重复/相似/互相覆盖的经验难以被主动整合。
2. **缺少“成长触发”**：沉淀结束后没有自动进入“学习/反思/整合”的动作，导致经验库只能增长，难以变得更精炼更强。
3. **缺少“质量准则建议”输出**：无法从多条经验中抽象出更高维的质量准则建议（例如：风险偏好、代码边界、验证强度），也无法将其作为建议交由人采纳/拒绝。

### 1.3 解决方案概述（不含技术实现细节）

在每次成功沉淀新经验后，系统应自动触发“成长循环”，输出两类建议：

- **经验治理（自动执行）**：自动识别候选合并组、候选取代链，并直接落盘执行（合并/取代/索引更新）；同时输出变更报告与可回滚说明。
- **质量准则建议（人工采纳）**：从近期沉淀中提炼“质量判断/风险偏好/工程标准”的建议，但必须由人确认是否采纳（可转化为 rules/skills/checklists 等）

约束：

- 不专门实现“遗忘”特性；通过“合并/取代”自然降低噪声与冗余。
- 候选合并组、候选取代链**允许自动执行**；质量准则建议只能给建议，**人决定是否采纳**。
- 学习触发不基于固定阈值；应在**每次产生新的沉淀**后自动触发。

---

## 2. 目标与指标

### 2.1 目标

| 编号 | 目标 | 优先级 |
|---|---|---|
| G1 | 每次新增经验沉淀后，自动触发“成长循环”并输出治理/质量准则建议 | 必须实现 |
| G2 | 支持经验之间的“合并/取代”关系表达，并可持续维护 | 必须实现 |
| G3 | 保持人工闸门：任何会影响长期知识库结构/规则/技能的变化都应可回退、可审阅 | 必须实现 |

### 2.2 非目标

- 不做独立的“遗忘/删除”机制（不主动清理、不过期删除）。
- 不追求完全自动化的“质量准则训练落盘”（仅建议，由人决定）。
- 不引入复杂的全自动聚类/机器学习系统（先用可解释、可验证的规则/流程达成）。

### 2.3 成功标准（必须可验证）

| 标准 | 描述 | 验证方式 |
|---|---|---|
| S1 | 当用户执行 `/flow 沉淀 ...` 成功写入至少 1 条经验后，系统在同一轮或紧随其后的交互中给出“成长建议” | 手工步骤 |
| S2 | 系统自动执行经验治理：完成候选合并组、候选取代链的落盘执行，并输出变更报告（含理由/影响/回滚方式） | 手工步骤 |
| S3 | 对“质量准则建议”，用户可选择接受/拒绝；拒绝不应破坏现有知识库一致性 | 手工步骤 |
| S4 | 合并/取代后的知识库仍可追溯：可从新经验找到被取代/合并的旧经验指针 | 手工步骤 |

---

## 3. 用户故事（至少 1 条）

### US-1: 我希望经验库越用越精炼

**作为** 使用 workflow 的工程师
**我想要** 每次沉淀新经验后系统自动提示“哪些经验应该合并/取代”
**以便** 我只需要做确认决策，经验库能持续精炼并形成更普适的知识

**验收标准：**
- [ ] 沉淀后自动执行治理动作（合并/取代）并输出变更报告
- [ ] 我能明确看到执行的理由与影响
- [ ] 执行后可追溯且可回滚

### US-2: 我希望系统给出质量准则/风险建议，但最终由我决策

**作为** 代码质量与风险的最终责任人
**我想要** 系统从新沉淀中提炼“质量准则/风险提示/质量标准”的建议
**以便** 我决定是否将其升级为 rules/skills/checklists，从而让系统更稳

**验收标准：**
- [ ] 每次沉淀后至少输出 1-3 条“质量准则/风险建议”
- [ ] 明确标注为建议而非强制
- [ ] 我可选择“采纳并落盘到规则/技能/清单”或“暂不采纳”

---

## 4. 功能需求（按需）

| 编号 | 需求描述 | 优先级 |
|---|---|---|
| F1 | 每次成功新增经验沉淀后自动触发“成长循环”（无需固定阈值） | 必须实现 |
| F2 | 成长循环自动生成并执行“经验治理动作”：候选合并组（同主题重复/高度相似） | 必须实现 |
| F3 | 成长循环自动生成并执行“经验治理动作”：候选取代链（新经验可取代旧经验，旧经验进入 deprecated） | 必须实现 |
| F4 | 治理动作执行后必须输出变更报告：证据/理由/影响范围/回滚方式（至少说明如何手工回退） | 必须实现 |
| F5 | 输出“质量准则建议”：从近期沉淀中抽象出质量判断/风险偏好/工程标准（仅建议） | 必须实现 |
| F6 | 用户可选择对“质量准则建议”执行：采纳（升级到 rules/skills/checklists）/拒绝（不做变更） | 必须实现 |
| F7 | 合并/取代后索引可追溯：新经验能指回旧经验（Replaces/ReplacedBy） | 必须实现 |
| F8 | 不影响现有“确认沉淀”闸门：未确认不得写 experience；采纳治理建议也应在确认语境下执行 | 必须实现 |

---

## 5. 验收检查清单

- [ ] 沉淀新增经验后，自动触发输出“成长建议”（治理 + 质量准则建议）
- [ ] 治理动作自动执行：合并/取代有明确执行结果与变更报告
- [ ] 合并/取代执行后索引一致、可追溯（至少能看到 replaced 链），且提供回滚说明
- [ ] 质量准则建议明确为“建议”，并提供采纳/拒绝路径（仅对质量准则做人工闸门）
- [ ] 保持人工闸门：所有长期知识变更均可被人审阅确认

