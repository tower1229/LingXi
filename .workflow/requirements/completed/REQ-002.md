# REQ-002: 创建验证 INDEX.md 格式的 Node.js 脚本

| 属性     | 值       |
| -------- | -------- |
| 版本     | 1.0      |
| 创建日期 | 2026-01-29 |
| 需求类型 | 简单功能 |
| 复杂度   | 简单     |

---

## 1. 概述

### 1.1 背景

cursor-workflow 使用 `.workflow/requirements/INDEX.md` 作为需求状态的单一事实来源（SSoT）。该文件需要遵循严格的格式规范，包括：

- 表头必须包含 7 个字段：ID | Title | Status | Current Phase | Next Action | Blockers | Links
- 每行的 ID 必须符合 REQ-xxx 格式
- Status 和 Current Phase 的值必须有效
- 索引中的 REQ 对应的文件必须存在
- Status 和文件位置必须匹配（completed → completed/，其他 → in-progress/）

目前缺少一个自动化工具来验证这些格式和一致性规则，导致可能的人为错误难以及时发现。

### 1.2 问题描述

- 手动检查 INDEX.md 格式容易遗漏错误
- 文件一致性和目录一致性需要人工验证
- 缺少快速验证工具，无法在 CI/CD 或开发流程中集成

### 1.3 解决方案概述

创建一个 Node.js 脚本，自动验证 INDEX.md 的格式和一致性，输出清晰的验证结果和错误详情。

---

## 2. 目标

| 编号 | 目标 | 优先级   |
| ---- | ---- | -------- |
| G1   | 验证表头格式（7 个字段） | 必须实现 |
| G2   | 验证每行的 ID 格式（REQ-xxx） | 必须实现 |
| G3   | 验证 Status 值有效性 | 必须实现 |
| G4   | 验证 Current Phase 值有效性 | 必须实现 |
| G5   | 检查文件一致性（索引中的 REQ 对应的文件是否存在） | 必须实现 |
| G6   | 检查目录一致性（Status 和文件位置是否匹配） | 必须实现 |

---

## 3. 验收检查清单

- [ ] 脚本能够读取 `.workflow/requirements/INDEX.md` 文件
- [ ] 脚本能够解析表头和表格行
- [ ] 脚本能够验证表头格式（7 个字段）
- [ ] 脚本能够验证每行的 ID 格式（REQ-xxx）
- [ ] 脚本能够验证 Status 值有效性（in-progress/planned/in-review/needs-fix/completed）
- [ ] 脚本能够验证 Current Phase 值有效性（req/plan/audit/work/review/archive）
- [ ] 脚本能够检查文件一致性（索引中的 REQ 对应的文件是否存在）
- [ ] 脚本能够检查目录一致性（Status 和文件位置是否匹配）
- [ ] 脚本能够输出清晰的验证结果（成功/失败，错误详情）
- [ ] 脚本能够作为命令行工具运行（如 `node scripts/validate-index.js`）
