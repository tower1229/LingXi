# 003.req.灵犀插件化改造

| 属性     | 值         |
| -------- | ---------- |
| 版本     | 1.0        |
| 状态     | 草稿       |
| 创建日期 | 2026-02-21 |
| 需求类型 | 全栈       |
| 复杂度   | 中等       |

---

## 1. 概述

### 1.1 背景

- Cursor 已开放官方 [Plugin 机制](https://cursor.com/cn/docs/plugins/building)：插件可打包并分发 rules、skills、agents、commands、hooks、MCP；安装后在 IDE/CLI/Cloud 统一可用。
- 灵犀当前通过自研安装脚本（`install/bash.sh`、`install/powershell.ps1`）将 `.cursor/` 及 `.cursor/.lingxi/` 骨架拷贝到用户项目，存在维护成本与官方能力重叠。
- 将灵犀改造为 Cursor 官方插件后，安装与更新由 Cursor 负责，灵犀只需提供清单与组件；项目级运行时目录（`.cursor/.lingxi/`）改为首次使用（如 `/init`）时在项目内创建即可。

### 1.2 问题描述

- 需要一份**可执行的任务文档**，明确插件化改造的范围、产物与验收标准。
- 需要**外部资料清单**：建议的 `plugin.json`、用于生成 Logo 的 prompt、以及提交前检查项，便于实施与提交市场。

### 1.3 解决方案概述（不含技术实现细节）

- **清单与目录**：新增 `.cursor-plugin/plugin.json`，通过显式路径引用现有 `.cursor/commands`、`.cursor/skills`、`.cursor/agents`、`.cursor/hooks.json`，保持现有目录结构，避免大挪动。
- **运行时目录**：不再由安装脚本创建 `.cursor/.lingxi/`；由 `/init`（init-executor）或首次使用相关命令时在**当前工作区**创建 tasks、memory/notes、memory/references、workspace 及模板与 INDEX。
- **安装程序下线**：删除 `install/` 下脚本与安装清单；README 安装改为「从 Cursor 插件市场安装」+「可选运行 /init 初始化项目」。
- **Hook 路径**：在插件形态下确认 hook 的 `command` 解析规则（相对插件根或工作区根），必要时适配或文档说明。
- **外部资料**：提供 plugin.json 示例、Logo 生成 prompt、README 与 frontmatter 检查清单，便于一次性备齐提交所需素材。

---

## 2. 目标与指标

### 2.1 目标

| 编号 | 目标 | 优先级   |
| ---- | ---- | -------- |
| G1   | 灵犀可作为 Cursor 官方插件安装，无需自研安装脚本 | 必须实现 |
| G2   | 项目级运行时目录（.cursor/.lingxi/）由 /init 或首次使用在项目内创建 | 必须实现 |
| G3   | 提供完整任务文档与外部资料（plugin.json 建议、Logo prompt、检查清单） | 必须实现 |
| G4   | README 与 about-lingxi 等文档同步为「插件安装」叙事 | 必须实现 |

### 2.2 非目标

- 本需求不包含：多插件仓库（marketplace.json）、插件市场审核流程的详细对接、MCP 服务器打包。
- 不包含：对现有 Skills/Commands 业务逻辑的重构，仅涉及清单、安装方式与文档。

### 2.3 成功标准（必须可验证）

| 标准 | 描述 | 验证方式 |
| ---- | ---- | -------- |
| S1   | 存在 `.cursor-plugin/plugin.json`，且含 name、skills/commands/agents/hooks 路径（或等效发现） | 查看清单文件 |
| S2   | 安装插件后，在任意项目中可使用 /req、/init 等命令 | 新工作区安装插件后执行命令 |
| S3   | 未运行安装脚本时，运行 /init 可在项目内创建 .cursor/.lingxi/ 骨架（tasks、memory、workspace 等） | 空项目安装插件 → 仅执行 /init → 检查目录与模板 |
| S4   | README 安装章节改为插件安装说明，无 curl/irm 一键安装 | 查看 README |
| S5   | 任务文档或附录中包含建议的 plugin.json、Logo 生成 prompt、提交前检查清单 | 查看本 req 文档与附录 |

---

## 3. 用户故事（至少 1 条）

### US-1: 通过插件市场安装灵犀

**作为** 灵犀使用者  
**我想要** 在 Cursor 中通过官方插件方式安装灵犀，而不是执行远程脚本  
**以便** 安装与更新由 Cursor 统一管理，且符合官方安全与发现体验。

**验收标准：**

- [ ] 灵犀仓库包含 `.cursor-plugin/plugin.json`，可被 Cursor 识别为插件。
- [ ] 安装后，/req、/plan、/build、/review、/init、/remember 等命令可用。

### US-2: 新项目快速用上灵犀

**作为** 灵犀使用者  
**我想要** 在已有代码项目中安装插件后，通过一次 /init 即可初始化工作区与记忆  
**以便** 不需要再运行任何安装脚本。

**验收标准：**

- [ ] /init 执行时若 `.cursor/.lingxi/` 不存在，则创建所需目录与模板文件。
- [ ] README 说明为「安装插件 → 可选运行 /init 初始化项目」。

---

## 4. 功能需求

| 编号 | 需求描述 | 实现方案 | 验收标准 | 优先级   |
| ---- | -------- | -------- | -------- | -------- |
| F1   | 新增插件清单 `.cursor-plugin/plugin.json` | 在仓库根新增 `.cursor-plugin/plugin.json`，必填 name（如 `lingxi`），可选 description、version、author、keywords；通过 `commands`、`skills`、`agents`、`hooks` 指向现有 `.cursor/` 下路径（见附录 11.1） | 文件存在且 Cursor 可识别 | 必须实现 |
| F2   | 插件化后 Hook 可正确执行 | 确认 Cursor 执行 hook 时的工作目录/插件根；若为插件根，保持 `node .cursor/hooks/session-init.mjs` 等；若为工作区根，需改为基于插件根的路径或文档说明 | 新会话开始时 sessionStart 约定被注入 | 必须实现 |
| F3   | 项目内 .cursor/.lingxi/ 由使用侧创建 | 在 init-executor 中：若检测到 `.cursor/.lingxi/` 或关键子目录不存在，则创建 workflowDirectories（tasks、memory/notes、memory/notes/share、memory/references、workspace），并写入 workflowTemplateFiles 与 INDEX 占位（与当前 install 清单一致） | 空项目仅安装插件后执行 /init，目录与模板齐全 | 必须实现 |
| F4   | 删除自研安装程序 | 删除 `install/bash.sh`、`install/powershell.ps1`、`install/install-manifest.json`、`install/test-install.sh`；保留 `install/README.md` 时可改为「已废弃，请使用 Cursor 插件安装」或移除 | 无脚本可被误用，README 无 curl/irm 安装 | 必须实现 |
| F5   | README 安装与快速开始更新 | 「安装」改为从 Cursor 插件市场安装；「快速开始」保留命令表，补充「首次建议运行 /init 初始化项目」 | 文档与 G4/S4 一致 | 必须实现 |
| F6   | 提供 Logo 与清单可选字段 | 提供 `assets/logo.svg`（或等价）及 plugin.json 中 `"logo": "assets/logo.svg"`；附录提供用于生成 Logo 的 prompt（见 11.2） | 提交前检查可通过；Logo 可被市场展示 | 建议实现 |
| F7   | 所有 Skills/Commands/Agents 具备完整 frontmatter | 按 Cursor 提交前检查，为所有 skills、commands、agents 补全 name、description 等 frontmatter | 清单校验无 frontmatter 缺失 | 必须实现 |
| F8   | about-lingxi 与架构文档同步 | architecture.md、core-values.md、README 等中「安装」「开箱即用」表述改为插件安装；若保留「模板仓库」则与「插件安装」并列说明 | 文档一致、无矛盾 | 必须实现 |

---

## 5. 依赖与集成

### 5.1 外部依赖

- Cursor 官方插件机制（清单格式、组件发现、提交与发布流程）。
- 参考文档：[构建插件](https://cursor.com/cn/docs/plugins/building)、[提交插件](https://cursor.com/marketplace/publish)。

### 5.2 集成方式

- 灵犀作为单插件仓库提交；清单中路径均为相对路径，不包含 `..` 或绝对路径。

---

## 6. 验收检查清单

- [ ] `.cursor-plugin/plugin.json` 存在且含 name、paths。
- [ ] 安装插件后，在空白项目中可执行 /req、/init 等命令。
- [ ] 未执行任何安装脚本时，/init 能创建完整 `.cursor/.lingxi/` 骨架。
- [ ] `install/` 下安装脚本已删除或明确废弃；README 安装章节为插件安装。
- [ ] 本 req 附录中含建议的 plugin.json、Logo 生成 prompt、提交前检查清单。
- [ ] 所有 Skills、Commands、Agents 具备完整 frontmatter。
- [ ] about-lingxi 与 README 中安装/开箱即用表述已更新。

---

## 7. 附录

### 7.1 建议的 plugin.json（示例）

以下为建议的 `.cursor-plugin/plugin.json` 内容（路径相对于仓库根；最终以 Cursor 官方字段名为准）：

```json
{
  "name": "lingxi",
  "version": "1.0.0",
  "description": "为创造者打造的 AI 时代工作流与记忆系统：可伸缩任务流（req/plan/build/review）、持久化记忆与检索、开箱即用。",
  "author": {
    "name": "LingXi"
  },
  "keywords": [
    "workflow",
    "memory",
    "task",
    "review",
    "req",
    "plan",
    "build",
    "cursor"
  ],
  "license": "MIT",
  "homepage": "https://github.com/tower1229/LingXi",
  "repository": "https://github.com/tower1229/LingXi",
  "logo": "assets/logo.svg",
  "commands": ".cursor/commands",
  "skills": ".cursor/skills",
  "agents": ".cursor/agents",
  "hooks": ".cursor/hooks.json"
}
```

说明：

- `name`：必填，小写 kebab-case，如 `lingxi`。
- `commands` / `skills` / `agents` / `hooks`：显式指向现有目录或文件，避免默认目录发现与当前结构不一致。
- `logo`：可选，推荐仓库内 `assets/logo.svg`，提交市场时建议提供。

### 7.2 用于生成 Logo 的 Prompt（外部资料）

以下 prompt 可用于生成灵犀插件 Logo（供设计或图像模型使用）：

**中文版：**

```
设计一个灵犀（LingXi）插件的 Logo，用于 Cursor 插件市场展示。
要求：
- 风格：简洁、现代、易识别；适合作为小尺寸图标（如 64x64、128x128）。
- 主题：体现“心有灵犀、AI 辅助、工作流与记忆”的意象，避免过于具象的人物或复杂场景。
- 形式：可抽象符号（如光点、连线、书签、心形与脑回结合等）或极简字标“灵犀/LingXi”。
- 格式：矢量优先（SVG），或可导出为 SVG 的扁平图形；主色 1–2 种，便于在多背景下清晰可见。
- 约束：无侵权风险，适合技术/开发者产品品牌。
```

**英文版（供图像生成工具）：**

```
Design a logo for “LingXi”, a Cursor plugin for AI-assisted workflow and memory.
Requirements:
- Style: minimal, modern, recognizable at small sizes (e.g. 64x64, 128x128).
- Theme: suggest “intuition, AI assistance, workflow and memory” without literal figures or busy scenes.
- Form: abstract symbol (e.g. light dots, connections, bookmark, heart-and-mind motif) or simple wordmark “LingXi”.
- Format: vector-first (SVG) or flat graphic exportable to SVG; 1–2 primary colors for clarity on various backgrounds.
- Constraints: original, suitable for a developer tool brand.
```

### 7.3 提交前检查清单（外部资料）

依据 [Cursor 构建插件 - 提交前检查清单](https://cursor.com/cn/docs/plugins/building#%E6%8F%90%E4%BA%A4%E5%89%8D%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95) 整理：

- [ ] 存在有效的 `.cursor-plugin/plugin.json`。
- [ ] `name` 唯一、全小写、kebab-case（如 `lingxi`）。
- [ ] `description` 清晰说明插件用途。
- [ ] 所有 rules、skills、agents、commands 含完整 frontmatter（name、description 等）。
- [ ] Logo 已提交至仓库并通过相对路径引用（若提供）。
- [ ] `README.md` 说明用法及配置项（含安装方式与 /init 说明）。
- [ ] 清单中路径均为相对路径、有效且不含 `..`、非绝对路径。
- [ ] 插件已在本地完成安装与基本流程测试（/req、/init 等）。

---

## 8. 下一步建议（选一项）

**下一步可尝试（选一项）**

- **A) `/review-req 003`（推荐）**：审查本 req 文档，查漏补缺后再进入规划或实现。
- **B) `/plan 003`**：直接进入任务规划与测试设计。
- **C) `/build 003`**：在确认范围无异议后直接实现。
- **D) 补充/修改本 req**：若需增删目标或外部资料再写入。
