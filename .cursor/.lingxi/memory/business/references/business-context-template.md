# Business Context 模板

## 概述

Business Context 用于沉淀业务流程、业务规则、协作上下文等业务相关信息，帮助 workflow 快速理解项目的业务领域和业务逻辑。

**位置**：`.cursor/.lingxi/memory/business/<topic>.md`

**设计原则**（参考 `service-loader`）：
- **先索引后细节**：产物以"概要 + 指针"为主，不复制大段业务文档
- **Just-in-Time**：只生成后续会反复用到的高信号信息
- **可验证**：所有结论尽量附带"如何验证/去哪看"

---

## 模板结构

```markdown
# <Topic>（业务上下文）

## 1) 业务定位（What / Why）

- 业务目标：此业务模块/领域要解决什么问题
- 核心价值：为谁提供什么价值
- 业务背景：为什么需要这个业务模块

## 2) 业务边界（Scope）

- 负责什么：此业务模块的职责范围
- 不负责什么：明确不属于此模块的职责
- 与其他业务模块的边界：与其他模块的交互点和职责划分

## 3) 关键流程（Processes）

- 核心业务流程：主要业务流程的概要（指针级，不复制细节）
  - 流程 1：简要描述 → 关键决策点 → 指针（相关文档/代码）
  - 流程 2：简要描述 → 关键决策点 → 指针
- 关键决策点：业务流程中的关键判断和分支条件

## 4) 业务规则（Rules）

- 业务约束：业务层面的约束条件（如：用户等级限制、时间窗口、数量限制等）
- 业务逻辑要点：核心业务逻辑的要点（指针级，指向具体实现）
- 异常处理规则：异常情况的处理方式

## 5) 协作上下文（Collaboration）

- 涉及团队/角色：哪些团队/角色与此业务相关
- 协作方式：如何与其他团队协作（如：API 契约、数据格式、通知机制等）
- 关键接口/契约：与其他模块/系统的关键接口和契约

## 6) 常见问题（FAQ）

- 常见误解：容易误解的业务概念或规则
- 常见坑点：常见的业务逻辑错误或陷阱
  - 若属于"高价值可复用坑"，记录为 experience 候选（使用  沉淀`/remember`）
- 常见问题解答：常见问题的答案和指针
```

---

## 使用场景

### 何时创建 Business Context

1. **项目初始化**：执行 `/init` 命令时，识别业务流程并创建业务上下文文档
2. **新业务模块接入**：当 workflow 需要理解新的业务模块时
3. **跨团队协作**：需要明确业务边界和协作方式时
4. **业务规则沉淀**：需要将业务规则系统化记录时

### 与 Service Context 的区别

| 维度 | Business Context | Service Context |
|-----|-----------------|----------------|
| **关注点** | 业务逻辑、业务流程、业务规则 | 技术实现、服务边界、技术依赖 |
| **位置** | `.cursor/.lingxi/memory/business/` | `.cursor/.lingxi/memory/tech/services/` |
| **使用场景** | 理解业务领域、业务决策 | 理解技术架构、服务调用 |
| **示例** | 用户注册流程、订单处理规则 | API 服务、数据库服务 |

---

## 最佳实践

### 1. 保持精简

- 只记录**高信号**信息（后续会反复用到的）
- 避免复制大段业务文档，使用指针指向原始文档
- 重点记录**容易忘记**或**容易出错**的业务规则

### 2. 保持可验证

- 所有业务规则尽量附带"如何验证/去哪看"
- 关键流程提供代码/文档指针
- 业务约束提供验证方式

### 3. 及时更新

- 当业务规则变更时，及时更新 Business Context
- 当发现新的常见坑点时，记录为 experience 候选

### 4. 与 Experience 的配合

- 如果业务规则/坑点属于"可迁移的判断结构"，应沉淀为 Experience
- Business Context 提供业务背景，Experience 提供判断依据

---

## 示例

### 示例 1：用户注册业务上下文

```markdown
# 用户注册（业务上下文）

## 1) 业务定位（What / Why）

- 业务目标：为新用户提供注册入口，建立用户账户体系
- 核心价值：为平台积累用户基础，支持后续业务功能
- 业务背景：用户需要注册账户才能使用平台的核心功能

## 2) 业务边界（Scope）

- 负责什么：用户注册流程、账户创建、初始信息收集
- 不负责什么：用户登录、密码找回、用户信息修改
- 与其他业务模块的边界：
  - 与用户登录模块：注册成功后自动登录（通过 API 调用）
  - 与用户信息模块：注册时收集的信息后续可在用户信息模块修改

## 3) 关键流程（Processes）

- 注册流程：
  1. 用户填写注册信息（手机号/邮箱、密码、验证码）
  2. 验证码校验（调用验证码服务）
  3. 检查用户是否已存在（调用用户服务）
  4. 创建用户账户（调用用户服务 API）
  5. 发送欢迎消息（调用消息服务）
  - 关键决策点：
    - 手机号和邮箱二选一（业务规则：至少提供一个）
    - 密码强度要求（业务规则：至少 8 位，包含字母和数字）
  - 指针：`src/services/user/register.ts`、`docs/business/user-registration.md`

## 4) 业务规则（Rules）

- 业务约束：
  - 手机号格式：11 位数字，以 1 开头
  - 邮箱格式：标准邮箱格式
  - 密码强度：至少 8 位，包含字母和数字
  - 验证码有效期：5 分钟
- 业务逻辑要点：
  - 手机号和邮箱不能同时为空（至少提供一个）
  - 如果手机号已注册，不允许重复注册（提示"该手机号已注册"）
  - 如果邮箱已注册，不允许重复注册（提示"该邮箱已注册"）
  - 指针：`src/services/user/register.ts`（validateUserInfo 函数）

## 5) 协作上下文（Collaboration）

- 涉及团队/角色：
  - 前端团队：注册页面 UI
  - 后端团队：注册 API 实现
  - 验证码服务团队：验证码生成和校验
- 协作方式：
  - API 契约：`POST /api/user/register`（见 `docs/api/user-register.md`）
  - 数据格式：JSON（见 `src/types/user.ts`）
  - 错误码：见 `docs/api/error-codes.md`
- 关键接口/契约：
  - 验证码服务：`GET /api/captcha/generate`、`POST /api/captcha/verify`
  - 用户服务：`POST /api/user/register`、`GET /api/user/check-exists`

## 6) 常见问题（FAQ）

- 常见误解：
  - 误解：手机号和邮箱必须都提供
  - 澄清：至少提供一个即可（业务规则）
- 常见坑点：
  - 坑点：验证码校验和用户存在性检查的顺序错误，导致验证码被消耗但注册失败
  - 解决方案：先检查用户是否存在，再校验验证码（避免验证码浪费）
  - 指针：`src/services/user/register.ts`（register 函数）
  - （候选）可沉淀为 experience：验证码校验的时机选择
```

---

## 与 Service Loader 的配合

当执行 `/init` 命令或使用 `service-loader` 时：

1. **技术层面**：使用 `service-loader` 生成服务上下文（`.cursor/.lingxi/memory/tech/services/<service>.md`）
2. **业务层面**：使用 Business Context 模板生成业务上下文（`.cursor/.lingxi/memory/business/<topic>.md`）
3. **经验层面**：识别可沉淀的业务规则/坑点，通过 `/remember` 沉淀为 Experience

---

## 参考

- [Service Loader SKILL.md](../../../../../.cursor/skills/service-loader/SKILL.md) - 服务上下文加载机制参考
- [Experience Depositor SKILL.md](../../../../../.cursor/skills/experience-depositor/SKILL.md) - 经验沉淀机制参考
- [Data Models](../../../../docs/02-design/data-models.md) - 数据模型定义
