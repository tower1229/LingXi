# Workflow 生命周期（业务上下文）

## 1) 业务定位（What / Why）

- **业务目标**：提供 AI workflow 的项目级成长能力，让 AI 在项目工作中持续积累经验，并将经验提炼为可复用的质量准则
- **核心价值**：
  - 解决同类问题反复发生的问题（AI 每次都像第一次遇到）
  - 解决判断不稳定的问题（形成"这个项目里我们长期相信的判断"）
  - 解决过程知识难沉淀的问题（排查路径、验证方式、关键取舍能够被系统化记录）
  - 解决重复任务不变快的问题（同样的任务做 100 次会越来越快）
- **业务背景**：传统方案（硬编码提示词、会话级上下文、人工总结）存在局限，需要机制化的知识沉淀与自动化改进系统

## 2) 业务边界（Scope）

- **负责什么**：
  - 需求全生命周期管理（req → plan → build → review）
  - 经验沉淀机制（EXP-CANDIDATE 捕获、experience-capture 评估并暂存、experience-depositor 沉淀和治理）
  - 经验治理机制（experience-depositor 使用语义搜索 + 关键词匹配双重验证，合并/取代）
  - 质量资产管理（通过记忆系统统一管理团队级标准/经验和项目级经验）
  - 上下文管理（service-loader 服务上下文、business context 业务上下文）
- **不负责什么**：
  - 不负责代码实现（由 AI 根据 plan 执行）
  - 不负责项目部署（由项目自身负责）
  - 不负责外部系统集成（仅提供机制，不实现具体集成）
- **与其他业务模块的边界**：
  - 与 Cursor Editor：依赖 Cursor Nightly 的 Skills 机制，但不控制 Cursor 本身
  - 与项目代码：通过  目录管理 workflow 相关文件，不侵入项目代码

## 3) 关键流程（Processes）

- **需求推进流程**：
  1. 用户使用独立命令启动需求流程：
     - ：创建任务文档
     - （可选）：审查 req 文档
     - （可选）：任务规划
     - ：执行构建
     - ：审查交付
  2. 每个命令执行时，memory-index 自动匹配相关记忆并提醒
  3. 阶段 Skill 执行，生成产物
  4. 用户根据需要选择继续下一阶段或返回修改
  - **关键决策点**：
    - 各阶段使用独立命令，用户明确控制流程推进
    - 经验沉淀通过  命令独立执行（随时可用）
    - 质量资产沉淀通过 experience-depositor 处理
  - **指针**：、、、

- **经验沉淀流程**：
  1. 任务完成时，stop hook 引导调用 experience-capture skill
  2. experience-capture 扫描对话历史，识别经验信号并生成 EXP-CANDIDATE，执行评估，在会话中展示候选
  3. 用户选择要沉淀的候选（输入编号，如 `1,3` 或 `全部`）
  4. experience-depositor 从会话上下文获取候选，执行治理（语义搜索 + 关键词匹配双重验证）并沉淀
  5. 写入经验到 `.cursor/.lingxi/memory/experience/`
  6. 更新统一索引 `memory/INDEX.md`
  7. experience-depositor 写入前执行最终治理检查（合并/取代）
  - **关键决策点**：
    - 成长过滤器：判断是否进入长期知识库
    - 沉淀分流：判断应沉淀到哪里（团队级标准/经验、项目级经验、skills/context）
    - 冲突检测：检查与现有经验的冲突
  - **指针**：、、

- **项目初始化流程**：
  1. 用户执行  命令
  2. 引导式收集项目信息（技术栈、项目结构、开发规范、业务流程、服务/模块）
  3. 生成业务上下文文档（）
  4. 生成服务上下文文档（，如适用）
  5. 识别并输出经验候选（EXP-CANDIDATE）
  6. 生成初始化报告
  - **关键决策点**：
    - 信息收集方式：引导式收集，而非自动分析
    - 文档生成：基于模板生成，确保一致性
  - **指针**：、

## 4) 业务规则（Rules）

- **业务约束**：
  - 各阶段使用独立命令，用户明确控制流程
  - 经验沉淀必须用户确认（禁止未确认写入 ）
  - 质量资产沉淀必须用户确认（禁止未确认写入记忆库）
  - 统一索引 `memory/INDEX.md` 是记忆的单一事实源（SSoT）
  - 经验必须包含 Decision Shape 和 Judgment Capsule
- **业务逻辑要点**：
  - 成长过滤器：判断经验是否进入长期知识库（"一年后，在完全不同的项目里，这条信息还能帮我提前做出正确判断吗？"）
  - 沉淀分流：将知识放到最合适的载体（团队级标准/经验、项目级经验、skills/context）
  - 记忆治理：自动合并/取代
  - 指针：、

## 5) 协作上下文（Collaboration）

- **涉及团队/角色**：
  - 使用 workflow 的工程师：通过独立命令（、、、）推进需求，通过  确认经验沉淀
  - workflow 维护者：维护 Skills、Hooks，扩展 workflow 能力
- **协作方式**：
  - 通过 Skills 机制扩展能力（）
  - 通过记忆系统定义质量准则（团队级标准/经验和项目级经验）
  - 通过 Hooks 机制扩展行为（）
- **关键接口/契约**：
  - Skills 接口：Skills 必须包含 frontmatter（name、description），遵循 Skill 规范
  - 数据模型接口：统一索引 `memory/INDEX.md` 必须遵循表头结构，经验文档必须包含必要字段

## 6) 常见问题（FAQ）

- **常见误解**：
  - 误解：workflow 会自动实现代码
  - 澄清：workflow 只提供机制和流程，代码实现由 AI 根据 plan 执行
  - 误解：经验沉淀是自动的
  - 澄清：经验沉淀需要用户确认（使用  命令），遵循"确认机制"
- **常见坑点**：
  - 坑点：忘记选择经验候选进行沉淀
  - 解决方案：stop hook 会在任务完成时引导调用 experience-capture，候选在会话中展示，用户可直接选择沉淀
  - 指针：
  - （候选）可沉淀为 experience：经验沉淀确认的重要性
