# /init - 项目初始化命令

## ⚠️ 输出约束（必须遵守）

**禁止输出执行过程描述**：
- ❌ 禁止输出类似"开始执行 `/init` 命令"、"先了解相关 Skills"、"继续收集信息"等执行过程的自言自语
- ❌ 禁止输出工具调用信息（如"[4 tools called]"、"正在调用..."等）
- ✅ 直接输出结果内容，不要描述执行步骤
- ✅ 遵循"静默执行"原则：执行过程静默，只输出最终结果

**正确的输出方式**：
- 直接输出"命令目的说明"部分（不要先说"开始执行"）
- 直接输出收集到的信息（不要先说"正在收集"）
- 直接输出记忆候选和确认选项（不要先说"正在识别"）

## 命令用途

引导式初始化 workflow 到新项目，快速建立项目上下文（技术栈、常用模式、开发规则、业务流程），并将这些信息沉淀到记忆库：
- 记忆笔记（`.cursor/.lingxi/memory/notes/`）
- 统一索引（`.cursor/.lingxi/memory/INDEX.md`）

---

## 依赖的 Agent Skills

- `service-loader`：生成服务上下文文档
- `memory-capture`：捕获初始化过程中的判断/取舍为记忆候选（尽力而为）
- `memory-curator`：治理与写入记忆（合并优先、冲突否决、写入 notes + 更新 INDEX）

---

## 使用方式

```
/init
```

命令无需参数，通过对话式引导收集项目信息。

---

## 产物（必须写入）

- `.cursor/.lingxi/memory/notes/MEM-*.md`（初始化生成的记忆笔记，至少 1 个）
- `.cursor/.lingxi/memory/INDEX.md`（统一索引，随写入更新）

---

## 执行流程

### 0) 命令目的说明（必须）

在开始执行前，必须明确说明：

- `/init` 命令的目的：建立项目上下文，快速让 AI 理解项目
- 将生成的文档类型：业务上下文、服务上下文、记忆候选
- 执行流程概览：信息收集 → 文档生成 → 经验识别 → 沉淀确认

### 阶段 1：信息收集 + 即时识别记忆候选

**并行执行**：

1. 收集项目信息（技术栈、项目结构、开发规范、业务流程等）
2. **同时识别记忆候选**：
   - 技术栈选择理由（为什么选择某个技术栈）
   - 架构决策（为什么选择某个架构模式）
   - 开发规范取舍（为什么采用某个规范）
   - 记忆候选尽力而为由 `memory-capture` 捕获并在会话中展示

**必须明确展示**以下信息（不仅收集，还要在对话中展示供用户确认）：

- **项目结构信息**（必须展示）：
  - 项目类型：前端/后端/全栈/库/工具等
  - 目录结构：主要目录及其用途
  - 入口文件：主要入口文件路径
  - 构建配置：构建工具和配置方式

- **技术栈信息**：编程语言、框架/库、数据库、其他技术组件
- **开发规范信息**：代码规范、测试规范、提交规范、文档规范
- **业务流程信息**（如适用）：核心业务领域、关键业务流程、业务规则
- **服务/模块信息**（如适用）：服务列表、服务职责、服务依赖

**输出要求**：

- 展示收集的信息供用户确认
- 记忆候选尽力而为由 `memory-capture` 捕获并展示（如无候选则静默）
- 不输出技术细节（JSON 结构），不打断用户流程

**统一选择**（信息确认 + 下一步选择）：

在信息展示和候选暂存后，提供统一的选择：

```markdown
## 请确认并选择下一步

- 🚀 **A) 信息准确，直接进入文档生成阶段**
  - 基于当前信息生成业务上下文文档
  - 预计耗时：1-2 分钟

- 📝 **B) 信息准确，但需要重点调查某个模块**
  - 请指定模块名称（如：AI 分析流水线、配额管理）
  - 将深入调查该模块的架构、依赖、常见坑点
  - 预计耗时：2-5 分钟

- ✅ **C) 信息准确，继续深入调查所有模块**
  - 将调查：AI 分析流水线、GitHub 数据同步、配额管理、数据版本控制等
  - 预计耗时：5-10 分钟
- 产出：完整的服务上下文文档 + 更多记忆候选

- 📋 **D) 信息需要补充或修正**
  - 请说明需要补充或修正的内容
  - 补充后将重新展示信息并询问确认
```

**关键要求**：

- 记忆候选尽力而为由 `memory-capture` 捕获并展示（如无候选则静默）
- 如果用户选择 D（信息需要补充），补充后重新展示信息，再次询问确认
- 如果用户选择 A/B/C（信息准确），进入相应的下一步流程

### 阶段 2：深入调查 + 持续识别记忆候选

**执行内容**：

1. 根据用户指定的调查项进行深入调查
2. **同时回顾阶段 1 收集的信息**，补全遗漏的记忆候选
3. 识别常见坑点、深层架构决策
4. 记忆候选尽力而为由 `memory-capture` 捕获并展示（如无候选则静默）

**关键要求**：

- 必须回顾阶段 1 的信息，不能只关注用户指定的调查项
- 确保阶段 1 识别的记忆候选不被遗漏

### 阶段 3：汇总所有记忆候选

**执行内容**：

1. 记忆候选尽力而为由 `memory-capture` 捕获并展示（如无候选则静默）
2. 本阶段无需单独汇总，记忆捕获会在过程中尽力而为处理（无候选静默）

**输出格式**：

```markdown
## 识别的记忆候选

### 候选 1：[标题]

- **触发条件**：...
- **判断**：...
- **解决方案**：...
- **推荐载体**：memory/notes

### 候选 2：[标题]

...
```

### 阶段 4：生成上下文文档

根据收集的信息，生成相应的记忆文档：

- **记忆笔记**：使用 [Memory Note Template](../../../.cursor/.lingxi/memory/references/memory-note-template.md)，至少生成 1 个示例并写入 `memory/notes/`
- **服务/模块上下文**（如适用）：调用 `service-loader` Skill，但输出为 `memory/notes/` 中的 `Kind=tech` 记忆笔记

### 阶段 5：写入记忆（如适用）

如果用户选择写入记忆候选，调用 `memory-curator` Skill 处理治理与写入流程。

### 阶段 6：生成初始化报告

输出初始化报告（在对话中输出摘要，而非只保存到文件），包含：

- 生成的文档列表
- 识别的记忆候选列表（核心信息）
- 后续建议

---

## 委托给 Skills 的说明

本命令将以下任务委托给相应的 Skills：

- **生成服务上下文文档**：调用 `service-loader` Skill（参考 `.cursor/skills/service-loader/SKILL.md`）
- **写入记忆到记忆库**：调用 `memory-curator` Skill（参考 `.cursor/skills/memory-curator/SKILL.md`）
  - 经验记忆：团队级标准/经验或项目级经验
  - 技术记忆：服务上下文
  - 业务记忆：业务上下文

---

## 输出要求

- 必须生成至少 1 个业务上下文文档
- 必须输出初始化报告（在对话中输出摘要）
- **记忆候选处理**：
  - 记忆候选由 `memory-capture` 尽力而为捕获并展示
  - 用户可选择写入（输入编号，如 `1,3` 或 `全部`，由 `memory-curator` 治理与写入）
  - 写入落点：`memory/notes/` + 更新 `memory/INDEX.md`
- 最后用 3-6 行简短说明：生成了哪些文档、记忆候选将被展示（如有）
