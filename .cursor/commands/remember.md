# /remember - 即时记忆写入入口

## 命令用途

从用户输入或对话上下文中提取**记忆**并写入持久化记忆库（`memory/notes/`），并在写入前自动进行治理（合并优先、冲突否决），用于提升后续每轮的检索注入质量。

---

## 前置要求（必须）

- **Cursor Nightly**：本工作流依赖 Agent Skills（仅 Nightly 渠道可用）

---

## 依赖的 Agent Skills

- `memory-curator`（位于 `.cursor/skills/memory-curator/SKILL.md`）

## 使用方式

```
/remember [用户输入]
```

**用户输入必须提供**，可以是：

- **直接记忆表达**：`/remember 用户是唯一拥有价值判断能力的人`（从输入中提取并结构化记忆）
- **历史提取指引**：`/remember 吸取刚才这个 bug 的经验`（从对话历史中提取相关记忆）
- **混合模式**：`/remember 记住：... 另外：...`（分别处理）
- **简短提示**：`/remember 钱包选择问题`（帮助 AI 定位对话历史中要提取的内容）
- **关键词提示**：`/remember Apollo 配置`（帮助 AI 聚焦某个模块）

也支持“候选编号写入”（当捕获阶段已展示候选列表时）：

```
/remember 1,3
```

---

## 产物（必须写入）

- `.cursor/.lingxi/memory/notes/MEM-*.md`（记忆文件，需用户确认后写入）
- `.cursor/.lingxi/memory/INDEX.md`（统一索引，写入后自动更新/校验）

---

## 执行流程

### 1) 解析用户输入

**用户输入不能为空**。如果用户只输入 `/remember` 而没有提供任何内容，应提示用户提供输入。

**如果用户输入是编号格式**（如 `1,3`、`1 3`、`全部`、`all`），则直接委托给 `memory-curator` 处理（跳过信息提取步骤）。

**如果不是编号选择**，根据用户输入理解意图：

- **直接记忆表达**：用户直接陈述原则/判断（如"用户是唯一拥有价值判断能力的人"）
- **历史提取指引**：用户要求从对话历史中提取（如"吸取刚才这个 bug 的经验"）
- **提示词定位**：用户提供关键词帮助定位（如"钱包选择问题"）
- **混合模式**：同时包含直接经验表达和历史提取指引

### 2) 信息提取（如适用）

根据理解到的意图，从合适的来源提取信息：

- **如果用户输入是直接记忆表达**：从用户输入中提取核心判断/原则，推断触发条件、校验方式、关联指针等
- **如果用户输入是历史提取指引或提示词**：分析最近 5-15 轮对话，识别"问题 → 排查 → 解决"的完整流程

提取的信息包括：问题现象、根因、解决方案、触发条件、校验方式、关联指针。

**自动推断缺失信息**：优先通过上下文推断缺失信息（触发条件、校验方式、关联指针），而不是问用户。仅在关键信息完全无法推断时提问（最多 1 个问题，提供选项）。

### 3) 委托给 memory-curator（治理 + 写入）

将提取出的记忆委托给 `memory-curator` 执行治理与写入，包括：

- 语义近邻 TopK 治理（合并优先、冲突否决）
- 用户门控确认（涉及删除/取代时必须确认）
- 写入 `memory/notes/`
- 更新/校验 `memory/INDEX.md`

---

## 委托给 Skills 的说明

本命令将以下任务委托给相应的 Skills：

- **治理与写入流程**：调用 `memory-curator` Skill（参考 `.cursor/skills/memory-curator/SKILL.md`）
  - 编号选择解析（若输入是候选编号）
  - 语义近邻 TopK 治理（merge/replace/new/veto）
  - 用户确认删除/取代
  - 写入 `memory/notes/`
  - 更新/校验 `memory/INDEX.md`

---

## 输出要求

- **信息提取阶段**：如识别到可写入记忆，输出提取摘要（最小高信号）
- **后续流程**：治理/确认/写入由 `memory-curator` 处理
- **静默成功**：写入成功时尽量静默；只有需要用户确认或出现失败时才输出

---

## 示例场景

### 场景 1：直接经验表达

```
用户：/remember 用户是唯一拥有价值判断能力的人
AI：提取为记忆候选 → 委托给 memory-curator 治理与写入
```

### 场景 2：历史提取指引

```
用户：/remember 吸取刚才这个 bug 的经验
AI：从对话中提取“判断/信号/验证方式” → 委托给 memory-curator 治理与写入
```

### 场景 3：编号选择候选

```
用户：/remember 1,3
AI：从会话上下文获取候选（由 memory-capture 展示）→ 委托给 memory-curator 治理与写入
```
