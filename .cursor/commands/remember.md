# /remember - 即时记忆库沉淀命令

## 命令用途

智能提取并沉淀记忆到持久化记忆库，支持从用户输入直接提取记忆，或从对话历史中提取"刚解决的问题/踩的坑"。这是最低摩擦的"即时沉淀入口"。

**存储目标**：用户可选择存入：
- **经验记忆**：团队级标准（`memory/experience/team/standards/`）、团队级经验（`memory/experience/team/knowledge/`）或项目级经验（`memory/experience/project/`）
- **技术记忆**：服务上下文（`memory/tech/services/`）
- **业务记忆**：业务上下文（`memory/business/`）

---

## 前置要求（必须）

- **Cursor Nightly**：本工作流依赖 Agent Skills（仅 Nightly 渠道可用）

---

## 依赖的 Agent Skills

- `experience-depositor`（位于 `.cursor/skills/experience-depositor/SKILL.md`）

## 使用方式

```
/remember [用户输入]
```

**用户输入必须提供**，可以是：

- **直接经验表达**：`/remember 用户是唯一拥有价值判断能力的人`（AI 从输入中提取并结构化经验）
- **历史提取指引**：`/remember 吸取刚才这个bug的经验`（AI 从对话历史中提取相关经验）
- **混合模式**：`/remember 记住：用户是唯一拥有价值判断能力的人。另外，吸取刚才这个bug的经验`（AI 分别处理各部分）
- **简短提示**：`/remember 钱包选择问题`（帮助 AI 定位对话历史中要提取的内容）
- **关键词提示**：`/remember Apollo 配置`（帮助 AI 聚焦某个模块）

---

## 产物（必须写入）

根据用户选择的存储目标：

根据用户选择的存储目标：

- **如果选择经验记忆**：
  - `.cursor/.lingxi/memory/experience/team/standards/<tag>-<title>.md` 或
  - `.cursor/.lingxi/memory/experience/team/knowledge/<tag>-<title>.md` 或
  - `.cursor/.lingxi/memory/experience/project/<tag>-<title>.md`（记忆文件，需用户确认后写入）
  - `.cursor/.lingxi/memory/INDEX.md`（更新统一索引，需用户确认后写入）

- **如果选择技术记忆**：
  - `.cursor/.lingxi/memory/tech/services/<service>.md`（服务上下文文件，需用户确认后写入）
  - `.cursor/.lingxi/memory/INDEX.md`（更新统一索引，需用户确认后写入）

- **如果选择业务记忆**：
  - `.cursor/.lingxi/memory/business/<topic>.md`（业务上下文文件，需用户确认后写入）
  - `.cursor/.lingxi/memory/INDEX.md`（更新统一索引，需用户确认后写入）

---

## 执行流程

### 1) 解析用户输入

**用户输入不能为空**。如果用户只输入 `/remember` 而没有提供任何内容，应提示用户提供输入。

> **注意**：编号选择（如 `1,3`）通常直接输入即可，无需 `/remember` 前缀。如果用户使用 `/remember 1,3`，也支持，但建议直接输入编号。

**如果用户输入是编号格式**（如 `1,3`、`1 3`、`1,2,3`、`全部`、`all`），则直接委托给 `experience-depositor` Skill 处理（跳过信息提取步骤）。

**如果不是编号选择**，根据用户输入理解意图：

- **直接经验表达**：用户直接陈述经验/原则/判断（如"用户是唯一拥有价值判断能力的人"）
- **历史提取指引**：用户要求从对话历史中提取（如"吸取刚才这个 bug 的经验"）
- **提示词定位**：用户提供关键词帮助定位（如"钱包选择问题"）
- **混合模式**：同时包含直接经验表达和历史提取指引

### 2) 信息提取（如适用）

根据理解到的意图，从合适的来源提取信息：

- **如果用户输入是直接经验表达**：从用户输入中提取核心判断/原则，推断触发条件、校验方式、关联指针等
- **如果用户输入是历史提取指引或提示词**：分析最近 5-15 轮对话，识别"问题 → 排查 → 解决"的完整流程

提取的信息包括：问题现象、根因、解决方案、触发条件、校验方式、关联指针。

**自动推断缺失信息**：优先通过上下文推断缺失信息（触发条件、校验方式、关联指针），而不是问用户。仅在关键信息完全无法推断时提问（最多 1 个问题，提供选项）。

### 3) 成长过滤器

在决定"写入记忆文档（长期）"之前，对每条候选先回答一个问题：

> **如果我一年后在完全不同的项目里再遇到类似局面，这条信息还能帮我提前做出正确判断吗？**

- 若答案是 **否**：不写入记忆库，改为沉淀到 **session/worklog**（项目记录），并说明原因
- 若答案是 **是**：允许写入记忆库（长期判断资产），继续后续流程

### 4) 委托给 experience-depositor

将提取的经验信息委托给 `experience-depositor` Skill 处理，包括：

- 冲突检测（语义搜索 + 关键词匹配双重验证）
- 生成治理方案（方案模式）
- 执行治理动作（执行模式）
- 预览生成和存储目标选择
- 写入记忆库（经验记忆：团队级标准/经验或项目级经验；技术记忆：服务上下文；业务记忆：业务上下文）
- 索引更新
- 写入前执行治理（最终检查）

---

## 委托给 Skills 的说明

本命令将以下任务委托给相应的 Skills：

- **经验沉淀流程**：调用 `experience-depositor` Skill（参考 `.cursor/skills/experience-depositor/SKILL.md`）
  - 编号选择解析（如果用户输入是编号格式）
  - 冲突检测（语义搜索 + 关键词匹配双重验证，读取统一索引 memory/INDEX.md）
  - 生成治理方案（方案模式）
  - 执行治理动作（执行模式）
  - 预览生成和存储目标选择（经验记忆/技术记忆/业务记忆）
  - 写入对应目录
  - 索引更新（更新统一索引 memory/INDEX.md）
  - 写入前执行治理（最终检查）

---

## 输出要求

- **信息提取阶段**：如果识别到可沉淀记忆，输出提取的信息摘要
- **委托给 experience-depositor**：后续的预览、确认、写入等流程由 `experience-depositor` 处理
- **最后输出**（由 experience-depositor 输出）：
  - 用 3-6 行简短说明：提取了什么记忆、触发条件是什么、下次会在什么场景下自动提醒

---

## 示例场景

### 场景 1：直接经验表达

```
用户：/remember 用户是唯一拥有价值判断能力的人
AI：（识别为直接经验表达）
- 提取核心判断：用户是唯一拥有价值判断能力的人
- 推断触发条件：当 AI 需要做价值判断或决策时
- 推断校验方式：检查决策是否涉及价值判断，如是则必须询问用户

AI：委托给 experience-depositor 处理沉淀流程
```

### 场景 2：历史提取指引

```
用户：/remember 吸取刚才这个bug的经验
AI：（识别为历史提取指引，分析最近对话）
- 聚焦对话中关于 bug 的部分
- 提取：商品发放时选错钱包类型导致领取失败
- 触发条件：实现商品发放功能时
- 解决方案：虚拟商品必须发到虚拟钱包，实物商品发到实物钱包

AI：委托给 experience-depositor 处理沉淀流程
```

### 场景 3：编号选择候选

```
用户：/remember 1,3
AI：（识别为编号选择，直接委托给 experience-depositor）
- experience-depositor 从会话上下文获取候选（由 experience-capture 传递）
- 解析编号：选择第 1 和第 3 个候选
- 执行沉淀流程
```
