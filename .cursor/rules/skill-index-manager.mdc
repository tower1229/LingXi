---
description: "Skill: Index Manager (ai/requirements/INDEX.md as SSoT)"
globs:
  - "ai/requirements/**"
alwaysApply: true
---

# Skill：Index Manager（需求索引与状态）

## 目标

把 `ai/requirements/INDEX.md` 作为单一事实来源（SSoT），保证需求在 **Plan → Work → Review → Compound** 闭环中可追踪、可交接。

## 必须满足

- **任何 REQ 产物变更**（创建/计划/审查/完成）都必须同步更新 `ai/requirements/INDEX.md`
- `INDEX.md` 每行至少包含：
  - **ID**：`REQ-xxx`
  - **Title**
  - **Status**：`in-progress` / `planned` / `in-review` / `needs-fix` / `completed`
  - **Current Phase**：当前阶段（`req` / `plan` / `work` / `review` / `compound`）- 便于 Subagent 快速理解状态
  - **Next Action**：下一步建议动作（可选）- 当状态明确时填写
  - **Blockers**：阻塞项（可选）- 如有阻塞则列出关键问题
  - **Links**：至少包含 requirement 文件路径；按需补充 plan/review 等

## 更新规则（Fail Fast）

- 如果发现某个 `REQ-xxx` 在 `ai/requirements/in-progress/` 或 `ai/requirements/completed/` 存在文件，但 `INDEX.md` 无对应行：必须补齐
- 如果 `INDEX.md` 中存在某个 `REQ-xxx`，但对应文件不存在：必须指出并修复（创建缺失文件或修正索引）

## 状态文件格式规范（支持 Subagent 快速理解）

### INDEX.md 表格格式

```markdown
| ID | Title | Status | Current Phase | Next Action | Blockers | Links |
|---|---|---|---|---|---|---|
| REQ-001 | 示例需求 | in-progress | plan | 执行 `/plan REQ-001` | 无 | `ai/requirements/in-progress/REQ-001.md` |
```

**字段说明**：
- **Current Phase**：当前阶段，便于新 agent 窗口快速判断状态
- **Next Action**：明确的下一步动作，当状态清晰时填写（如："执行 `/plan REQ-001`"）
- **Blockers**：如有阻塞，列出关键问题（如："待产品确认接口规范"）

### Plan.md 状态摘要字段

在 `*.plan.md` 文件开头（目标回放后）增加状态摘要：

```markdown
## 状态摘要（Status Summary）

- **当前阶段**：work
- **进度**：5/12 任务完成
- **当前任务**：实现用户认证接口
- **阻塞项**：无
- **上次更新**：2025-01-11
```

**目的**：便于新 agent 窗口快速恢复上下文，无需完整读取 plan 文件即可了解当前状态。

## Link 约定

Links 字段优先写相对路径（示例）：

- `ai/requirements/in-progress/REQ-001.md`
- `ai/requirements/in-progress/REQ-001.plan.md`
- `ai/requirements/in-progress/REQ-001.review.md`
- `ai/requirements/completed/REQ-001.md`

