---
description: "Skill: Plan Manager (SSoT for execution ledger in <REQ-xxx>.plan.md)"
globs:
  - "ai/requirements/in-progress/*.plan.md"
  - "ai/context/session/**"
alwaysApply: true
---

# Skill：Plan Manager（Plan 作为执行账本 SSoT）

## 目标

把 `ai/requirements/in-progress/<REQ-xxx>.plan.md` 当作 **执行账本（execution ledger）**：

- Work 阶段的任务勾选、验证记录、关键决策、阻塞项，都必须落在 plan 里
- 为 `/compound <REQ-xxx>` 提供高信号输入（“可复用教训/可自动拦截点”），而不是依赖过时的 TODO 清单

## 核心约束（Fail Fast）

- **不允许只在对话里说“做完了”**：必须回写到 plan（任务勾选 + 验证记录）
- **每个关键任务必须有可复现验证**：写明“怎么验证/结果/证据指针”
- **阻塞项必须显式**：写在 plan 的状态摘要里，避免隐性阻塞导致上下文丢失

## Work 阶段写回规范（必须执行）

### 1) 状态摘要（Status Summary）

每次推进任务时，更新 plan 顶部的状态摘要：

- **当前阶段**：work / review / compound
- **进度**：X/Y
- **当前任务**：一句话描述正在做什么
- **阻塞项**：没有就写“无”
- **上次更新**：当天日期

### 2) 执行记录（Worklog）

每完成一个可交付的“最小步”（一个任务/一个子模块），追加一条 Worklog：

- **内容要求**：
  - 做了什么（指向具体文件/模块）
  - 关键决策（如有：为什么这么做）
  - **验证方式**：测试/脚本/手工步骤（必须可复现）
  - **结果**：PASS/FAIL + 失败原因（如 FAIL）
  - **指针**：相关文件路径/命令/日志位置

### 3) 复利候选（Compounding Candidates）

在 plan 中维护一个“复利候选”小节（Work 阶段持续补充），每条候选必须能转化为“下次更快更稳”的资产：

- **候选类型**（优先级从高到低）：
  - **automation**：可用 test/lint/script 拦截（最高 ROI）
  - **experience**：可复用教训（触发条件 + 校验方式 + 指针）
  - **context**：缺少的服务/模块概要（只写边界 + 指针）

- **每条候选必须包含**：
  - 触发条件（When to load）
  - 问题现象（Symptom）
  - 根因（Root cause）
  - 解决方案（Fix）
  - 校验方式（How to verify）
  - 关联指针（Pointers）

> 说明：`/compound` 以该小节为主输入；`/review` 可补充候选，但不应成为唯一来源。

