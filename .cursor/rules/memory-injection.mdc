---
description: "Memory injection: 每轮回答前检索并最小注入"
alwaysApply: true
---

# Memory Injection (Always Apply)

## 目的

在**每一轮**用户输入后、你给出最终答复前，强制执行一次“记忆提取 → 最小注入”，以提升一致性与长期复用能力。

## 强制行为

在开始回答用户问题前，先执行一次 **MemoryRetrieve**：

- **检索范围**：`.cursor/.lingxi/memory/notes/`
- **检索方式**：使用 Cursor 语义搜索（概念级匹配），用自然语言描述“用户当前要解决的核心问题/决策点/约束”进行查询
- **返回数量**：最多 Top 5
- **再筛选**：只保留与你当前回答“直接相关”的 Top 0-3 条（无关的一律丢弃）

## 最小注入规则（不要打扰用户）

- **无匹配**：完全静默（不要输出“无记忆”之类提示）
- **有匹配**：把每条记忆压缩为 1-2 句的“可执行提醒”，并在提醒后添加轻量引用（例如：`[MEM-xxxx]`），不单独占行
- **不要**把完整记忆原文贴进对话（除非用户明确要求查看）
- **不要**为了“完成注入”而硬塞内容；不相关就不注入

## 失败降级（允许继续回答）

如果语义检索在当前环境不可用或失败：

- 直接降级为无注入继续回答（仍保持静默）
- 不要阻断用户流程

## 输出行为要求

- 你可以在内部使用这些注入信息来影响方案选择、风险提示、默认约束等
- **不要在对外输出中显式声明“我检索了记忆库”**，除非这条记忆本身就是用户要求的交付物

