# 沉淀过滤标准（Noise Filter）

## 概述

本文档定义"明显噪音"的特征，用于在 experience-capture 中自动过滤不值得沉淀的候选。过滤标准基于**内容模式**而非关键词匹配/长度阈值，避免误判。

## 设计原则

1. **只过滤明显噪音**：边界模糊的候选仍进入暂存，由人判断（保护品味）
2. **基于内容模式**：通过结构完整性、语义特征判断，而非简单的关键词/长度匹配
3. **可解释性**：被过滤的候选必须提供明确理由，支持人工复核
4. **可复核性**：如果用户认为被误判，可以手动"强制沉淀"

## 明显噪音的判断规则（基于内容模式）

### 1. 结构缺失模式

**特征**：EXP-CANDIDATE 缺少必要的结构化字段

**判断标准**：
- 缺少 `decision` 字段（无法体现"判断了什么"）
- 缺少 `alternatives` 字段（无法体现"拒绝了什么"）
- 缺少 `signal` 字段（无法体现"判断依据"）

**示例**：
```json
{
  "stage": "work",
  "solution": "修复了 bug",
  "verify": "测试通过"
  // 缺少 decision、alternatives、signal
}
```

**过滤理由**：缺少判断结构，无法抽象为可复用的判断资产

### 2. 步骤复现模式

**特征**：内容只是"做了什么"的步骤描述，而非"如何判断"的结构

**判断标准**：
- 内容主要是操作步骤（"先做 A，再做 B，然后做 C"）
- 缺少 Decision Shape（Decision being made / Alternatives rejected / Discriminating signal）
- 无法回答"为什么这样做"、"拒绝了什么"、"靠什么信号判断"

**示例**：
```json
{
  "stage": "work",
  "decision": "修复 bug",
  "solution": "1. 找到错误代码 2. 修改逻辑 3. 运行测试 4. 提交代码"
  // 只是步骤描述，没有判断结构
}
```

**过滤理由**：只是步骤复现，无法抽象为判断结构

### 3. 无取舍依据模式

**特征**：没有 alternatives rejected，无法体现判断过程

**判断标准**：
- `alternatives` 字段为空或缺失
- 无法体现"拒绝了什么方案"、"为什么拒绝"
- 缺少取舍依据，无法形成可复用的判断模式

**示例**：
```json
{
  "stage": "plan",
  "decision": "选择方案 A",
  "solution": "使用方案 A 实现"
  // 缺少 alternatives，不知道拒绝了什么
}
```

**过滤理由**：缺少取舍依据，无法形成判断模式

### 4. 临时调试模式

**特征**：内容包含明显的临时调试痕迹

**判断标准**：
- 包含临时调试代码（如：console.log、debugger、临时变量名）
- 包含一次性错误信息（如：具体的报错堆栈，而非错误模式）
- 内容明显是"调试过程"而非"调试结论"

**示例**：
```json
{
  "stage": "work",
  "decision": "修复错误",
  "solution": "console.log('debug info'); // 临时调试代码",
  "signal": "Error: Cannot read property 'x' of undefined at line 123"
  // 包含临时调试代码和一次性错误信息
}
```

**过滤理由**：临时调试痕迹，无复用价值

### 5. 过于具体模式

**特征**：内容只适用于单一场景，无法抽象为可复用的判断结构

**判断标准**：
- 包含项目特定的路径、文件名、配置值（而非模式）
- 只适用于单一技术栈/框架版本（无法跨项目复用）
- 无法抽象为通用的判断原则

**注意**：此模式需要结合上下文判断，避免误判。如果内容虽然具体，但能抽象出判断模式（如：Decision Shape 完整），则不应过滤。

**示例**：
```json
{
  "stage": "work",
  "decision": "修复 /Users/project/src/components/Button.tsx 的 bug",
  "solution": "修改第 45 行的 onClick 处理函数",
  "pointers": ["/Users/project/src/components/Button.tsx:45"]
  // 过于具体，只适用于这个文件的这一行
}
```

**过滤理由**：过于具体，无法抽象为可复用的判断结构

## 边界模糊的处理

对于边界模糊的候选（不完全符合上述模式，但也不完全符合"值得沉淀"的标准），应：

1. **进入暂存**：不自动过滤，让用户判断
2. **标注低置信度**：在暂存中标注"可能不值得沉淀"，但由用户最终决定
3. **提供判断依据**：说明为什么可能不值得沉淀，帮助用户判断

## 实现要求

1. **在 experience-capture 中实现**：在执行评估时，应用上述判断规则
2. **提供明确理由**：被过滤的候选必须记录过滤理由（基于哪个模式）
3. **支持人工复核**：如果用户认为被误判，可以手动"强制沉淀"
4. **保护品味**：边界模糊的候选仍由人判断，不强制过滤
