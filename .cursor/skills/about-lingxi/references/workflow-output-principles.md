# 工作流输出与静默原则

本文档是灵犀工作流命令（/init、/task、/plan、/build、/review、/vet、/remember）及对应 executor Skill 的**输出与静默契约**。由各 Command 与 Skill 文档引用本文件统一约束，不通过全局 Rules 注入。

## 核心原则

1. **用户决策权不可侵犯**：所有需要用户判断的输出必须完整保留
2. **静默成功**：成功、无问题、无匹配时静默，不输出
3. **精简非决策输出**：减少非关键信息的冗余输出

## 明确保留的输出（用户决策权）

- **审查报告**：必须完整输出，用户需要根据完整报告自行判断
- **固定菜单选项**：必须保留，用户需要完整的判断选项
- **候选展示**：必须完整展示，用户需要了解足够的候选信息才能做出判断

## 工作流执行时的总原则

**适用**：仅当执行上述工作流命令或对应 executor Skill 时。

**总原则**：整体遵循静默原则；仅在便于用户理解或做决策时做解释性输出（如菜单选项、审查结论、错误原因、下一步建议）。

**正例**：直接给出结果/清单/选项；成功时静默或一句状态；失败时只说明错误与建议。

**反例**：不输出「开始执行…」「正在收集…」等过程旁白；不输出命令用途类说明（除非用户问）；不罗列内部组件名（如 task-executor、memory-retrieve）。

## 有产物时的下一步建议

task/plan/build/review/vet 在产生产物（写入文档或输出审查结果）后，**必须在当轮回复末尾**输出「下一步可尝试（选一项）」及 A/B/C/D 四项，与是否展示产物摘要无关；保证用户每步结束后都能看到可选的下一动作。格式与允许集合见各 executor Skill 的「下一步建议」小节。

---

## 按命令的示例

以下按命令给出典型场景下的正例与反例，便于 agent 对照执行。

### /task

**场景**：写入 task 文档成功；仅澄清未写入；写入失败。

**正例**：

- 写入成功且本步有正文输出时：回复末尾仅带下一步建议块，不输出「已写入 `001.task.xxx.md`」等确认。
- 仅澄清未写入：可不输出或一句「需求已澄清，需要我写入为 task 文档吗？」；未写入则无需下一步建议块。
- 写入失败：只输出错误原因与可操作建议（如路径不可写、权限不足），不输出过程旁白。

**反例**：

- 「开始收集需求…」「正在根据 task-executor 执行…」—— 过程旁白，违反静默。
- 「已成功写入 task 文档，路径为 `.cursor/.lingxi/tasks/001.task.xxx.md`。」—— 冗余确认，成功时应静默或仅通过下一步建议引导。

### /plan

**场景**：写入 plan/testcase 文档成功；本步未写入任何文档；写入失败。

**正例**：

- 写入成功且本步有输出时：静默或一句状态，末尾必须带「下一步可尝试（选一项）」及 A/B/C/D。
- 本步未写入任何 plan/testcase：可不包含下一步建议块。
- 写入失败：只输出错误信息与建议。

**反例**：

- 「正在拆解任务…」「plan 已生成，请查看。」—— 过程旁白与冗余确认。
- 写入了 plan 文档但回复末尾没有下一步建议块—— 有产物时必须输出。

### /build

**场景**：实现或测试通过；测试失败；本步未做任何实现或测试。

**约定**：若实现已偏离 task/plan，下一步可尝试中可包含「撤销更改 → 修订 plan 或 task → 重新 /build」。

**正例**：

- 通过时：可不展示实现/测试详情，末尾必须带下一步建议块。
- 失败时：输出失败详情与修复建议；若有实质性回复，末尾同样带下一步建议。
- 未产生任何代码或测试变更：可不包含下一步建议块。

**反例**：

- 「开始实现…」「正在执行 build-executor…」—— 过程旁白与内部组件名。
- 已实现需求但回复末尾无「下一步可尝试」—— 有产物时必须输出。

### /review

**场景**：审查完成（通过或不通过）；无论是否写入 review 报告文件。

**约定**：审查前若项目存在测试、类型检查或 lint，可优先执行或说明其状态，再进入各维度审查；下一步建议中可包含「运行测试/类型检查」等可验证动作选项。若实现已偏离 task/plan，下一步可尝试中可包含「撤销更改 → 修订 plan 或 task → 重新 /build」。

**正例**：

- 审查完成后：完整保留审查结论与报告内容供用户判断；**必须在当轮回复末尾**输出下一步建议块。可不输出报告全文，但不可省略下一步建议。
- 文件写入失败：只输出错误信息。

**反例**：

- 只输出「审查完成」或「review 已执行」且无下一步建议—— 有产物时必须输出建议。
- 输出「正在审查…」「调用 reviewer-doc-consistency…」—— 过程旁白与内部组件名。

### /vet

**场景**：审查完成，无问题或有问题。

**正例**：

- 无问题时：可简要总结；只要本步输出了审查结果，末尾必须带下一步建议块。
- 有问题时：列出问题清单与改进建议；末尾必须带下一步建议块。

**反例**：

- 只输出「审查完成」无下一步建议—— 只要输出了审查结果就必须带建议。
- 「开始审查 task 文档…」—— 过程旁白。

### /init

**场景**：有清单需用户校对/选择；无清单或静默完成。

**正例**：

- 有清单时：仅输出供用户决策/校对的清单或选项（最小高信号），不输出文件内容摘要。
- 无清单或静默完成时：可一句引导（如「用 /task、/build 等开始任务」）或完全静默。

**反例**：

- 「开始初始化…」「正在收集项目信息…」—— 过程旁白。
- 输出「执行 workspace-bootstrap…」「执行初始化…」—— 罗列内部组件名。

### /remember

**场景**：记忆写入成功；用户门控拒绝；子代理调用过程中。

**正例**：

- 主对话：调用阶段静默完成；写入成功可完全静默或仅一句结果（如「已记下。」）；用户拒绝时一句说明即可。
- 不暴露子代理或内部组件名。

**反例**：

- 「已调用 lingxi-memory 子代理完成写入。」「记忆已写入记忆库。」—— 暴露内部实现与冗余确认。
- 写入成功后长段复述记忆内容—— 非决策输出应精简。
