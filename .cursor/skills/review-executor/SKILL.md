---
name: review-executor
description: 当执行 /review 001 命令时自动激活，负责多维度审查和交付质量保证。
---

# Review Executor

## Instructions

### 1. 读取输入

- 扫描 `.workflow/requirements/` 目录
- 查找相关文件：
  - `<taskId>.req.*.md`（需求文档）
  - `<taskId>.plan.*.md`（如果存在，规划文档）
  - `<taskId>.testcase.*.md`（如果存在，测试用例文档）
- 定位 build 阶段编写的测试脚本文件

### 2. 测试用例文档审查

如果存在 `testcase` 文档：

- 读取 `<taskId>.testcase.*.md`
- 基于 req 审查测试用例文档
- 检查覆盖完整性、准确性
- 如不完整或不合格，补充或修改测试用例文档

### 3. 测试脚本质量检查（执行测试前）

- 读取 build 阶段编写的测试脚本文件
- 检查测试脚本的实现质量：

  - **覆盖完整性**：是否覆盖了 req 中的所有功能需求和验收标准
  - **断言准确性**：断言是否正确验证了预期行为，是否验证了关键结果
  - **测试隔离性**：测试之间是否相互独立，是否有外部依赖泄漏
  - **边界条件测试**：是否测试了边界情况、错误处理、异常场景
  - **测试可维护性**：测试代码是否清晰、可读，是否遵循测试最佳实践
  - **测试结构**：是否遵循"一行为一测试"原则，测试命名是否清晰

- **如果发现问题**：
  - 补充缺失的测试场景
  - 修正不准确的断言
  - 修复测试隔离问题
  - 补充边界条件测试
  - 优化测试代码结构

- **只有测试脚本质量合格后，才执行测试**

### 4. 测试执行

- 执行单元测试（基于 build 编写的测试脚本，已通过质量检查）
- 执行集成测试
- 记录测试执行结果（通过/失败/跳过）

**测试执行逻辑**：

- 使用项目中检测到的测试框架
- 执行命令：`yarn test` 或 `npm test`（由项目配置决定）
- 解析测试输出：提取通过/失败/跳过的测试数量
- 失败处理：列出失败用例，提供修复建议

**降级方案**：

如果测试框架无法执行（环境问题、依赖问题等）：
- 输出手动测试清单（基于 plan 的测试用例文档或 req 的验收标准）
- 提供测试步骤和预期结果
- 标记需要手动验证

### 5. 多维度审查（依次执行）

按以下维度依次审查，每个维度发现问题按优先级分级（Blockers/High/Medium/Low）：

#### 5.1 功能审查

检查内容：

- 是否符合 req 要求
- 功能是否完整实现
- 是否存在功能缺陷或需求偏差
- 是否存在回归风险

#### 5.2 测试覆盖审查

检查内容：

- **覆盖完整性**：
  - plan/testcase 中定义的所有可测试行为是否都有对应测试
  - 单元测试是否覆盖正常流程、边界条件、错误处理
  - 集成测试是否覆盖关键交互场景
- **测试质量**（已在步骤 3 检查，此处复核）：
  - 测试是否隔离（无外部依赖泄漏）
  - 测试是否遵循一行为一测试原则
  - 测试断言是否明确、有意义
  - 测试是否可重复执行
- **测试结果**：
  - 所有测试是否通过
  - 是否有被跳过（skip）的测试需要处理
  - 测试运行时间是否合理

**测试覆盖不足视为 High 级别问题**

#### 5.3 安全审查

检查内容：

- 是否存在安全漏洞或风险
- 是否存在注入风险
- 是否存在敏感信息暴露
- 权限控制是否合理

#### 5.4 性能审查

检查内容：

- 是否存在性能瓶颈或风险
- 是否存在内存泄漏风险
- 响应时间是否满足要求
- 资源使用是否合理

#### 5.5 架构审查

检查内容：

- 架构设计是否合理
- 模块耦合是否过紧
- 职责划分是否清晰
- 是否符合 req 中的架构思路

#### 5.6 可维护性审查

检查内容：

- 代码可维护性：代码结构是否清晰
- 代码可读性：命名是否清晰、注释是否充分
- 代码可扩展性：是否易于扩展
- 代码规范性：是否遵循项目代码规范

#### 5.7 回归风险审查

检查内容：

- 是否存在破坏现有功能的风险
- 是否影响其他模块
- 是否需要更新相关文档
- 是否需要通知相关团队

#### 5.8 文档一致性审查

检查内容：

- 代码与文档是否一致（检查 build 阶段同步的文档）
- 接口文档是否与实现一致
- 架构文档是否与代码结构一致

**注意**：经验捕获由 `experience-capture` Skill 统一处理，本 Skill 不包含经验捕获逻辑。

### 6. Review 文档写入

#### Review 文档模板

```markdown
# 001.review.<标题>

## 总结（3-6 行）

[简要总结审查结果：是否通过、主要问题、改进建议]

## 测试覆盖报告

### 测试执行结果

| 类型 | 通过 | 失败 | 跳过 |
|-----|-----|-----|-----|
| 单元测试 | X | 0 | 0 |
| 集成测试 | X | 0 | 0 |

### 行为覆盖情况

| 行为ID | 行为描述 | 测试状态 |
|-------|---------|---------|
| B1 | ... | ✅ 已覆盖 |
| B2 | ... | ✅ 已覆盖 |
| B3 | ... | ⚠️ 部分覆盖（缺少边界条件） |

### 测试质量评估

- 隔离性：✅ / ⚠️ / ❌
- 可维护性：✅ / ⚠️ / ❌
- 断言质量：✅ / ⚠️ / ❌

## 多维度审查结果

### 1. 功能审查

- Blockers:
- High:
- Medium:
- Low:

### 2. 测试覆盖审查

- Blockers:
- High:
- Medium:
- Low:

### 3. 安全审查

- Blockers:
- High:
- Medium:
- Low:

### 4. 性能审查

- Blockers:
- High:
- Medium:
- Low:

### 5. 架构审查

- Blockers:
- High:
- Medium:
- Low:

### 6. 可维护性审查

- Blockers:
- High:
- Medium:
- Low:

### 7. 回归风险审查

- Blockers:
- High:
- Medium:
- Low:

### 8. 文档一致性审查

- Blockers:
- High:
- Medium:
- Low:

## 汇总：分级 TODO

### Blockers

[列出必须修复的问题]

### High

[列出高优先级问题]

### Medium

[列出中优先级问题]

### Low

[列出低优先级问题]
```

#### 文档命名约定

- Review 文档：`001.review.<标题>.md`（标题 10 字以内，从 req 文档标题提取）
- **不存档**：review 文档不存档，每次执行会覆盖之前的文档

### 7. 审查结果处理

**优先级分级**：

- 每个维度发现问题按优先级分级（Blockers/High/Medium/Low）
- **测试覆盖不足视为 High 级别问题**
- Blockers 必须修复，High 可修复或明确接受风险
- 审查结论必须明确（通过/需修复/拒绝）

**审查结论**：

- **通过**：所有 Blockers 和 High 已处理，可以交付
- **需修复**：存在 Blockers 或 High 需要处理
- **拒绝**：存在严重问题，需要重大修改

---

## 使用场景

### 场景 1：完整审查流程

用户输入：`/review 001`

执行流程：
1. 读取输入（req、plan、testcase）
2. 测试用例文档审查
3. 测试脚本质量检查
4. 测试执行
5. 多维度审查（8 个维度）
6. Review 文档生成
7. 审查结果处理

### 场景 2：快速审查

用户输入：`/review 001`（简单功能）

执行流程：
1. 读取输入（仅 req）
2. 测试脚本质量检查（简化）
3. 测试执行
4. 多维度审查（重点维度）
5. Review 文档生成

---

## 注意事项

1. **经验捕获**：经验捕获由 `experience-capture` Skill 统一处理，本 Skill 不包含经验捕获逻辑
2. **测试质量优先**：测试脚本质量检查必须在测试执行前完成
3. **分级输出**：所有问题按优先级分级（Blockers/High/Medium/Low）
4. **明确结论**：审查结论必须明确（通过/需修复/拒绝）

---

## 与 Commands 的协作

本 Skill 由 `/review 001` 命令自动激活，执行逻辑完全由本 Skill 负责。Commands 只负责参数解析和产物说明。

---

## 参考

- **原 review.md 命令**：`.cursor/commands/review.md`（备份在 `.cursor/commands-backup/review.md`）
- **经验捕获**：`.cursor/skills/experience-capture/SKILL.md`
- **经验匹配**：`.cursor/skills/experience-index/SKILL.md`
