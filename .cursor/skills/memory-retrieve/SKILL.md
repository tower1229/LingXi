---
name: memory-retrieve
description: 每轮对话在回答前检索记忆库并最小注入。配合 Always Apply Rule 强保证触发；无匹配静默。
---

# Memory Retrieve

## 目标

在不打扰用户的前提下，从 `.cursor/.lingxi/memory/notes/` 中检索出可能有用的记忆，并以“最小高信号”的形式注入到你的回答决策中。

## 输入

- 当前用户问题（本轮 prompt）
- 当前上下文（最近对话、打开文件、当前任务阶段等，如可获得）

## 检索策略（语义优先）

1. **构建语义查询**（自然语言，不要提取关键词列表）：
   - 说明“用户现在要解决的核心问题/决策点/约束”
   - 说明“你希望查找的记忆类型：原则/模式/风险/约束/排障路径”等

   示例：

   > 我正在回答一个关于“记忆库重设计”的问题，需要在每轮强制注入记忆、并控制噪声与治理成本。查找相关记忆：注入策略、静默成功原则、AI Native 设计取舍。

2. **语义搜索**：对目录 `.cursor/.lingxi/memory/notes/` 做语义搜索（概念级匹配），取 Top 5。
3. **读取与重排**：对 Top 5 的候选文件逐个读取（或按需读取），判定“是否直接相关”。
4. **最小化**：最终只保留 Top 0-3 条最相关记忆。

## 最小注入格式（不打扰用户）

- **无匹配**：完全静默
- **有匹配**：每条记忆压缩为 1-2 句：
  - 一句“可执行提醒”（你希望自己立刻记住的那个约束/原则）
  - 轻量引用（例如：`[MEM-xxx]`），添加在可执行提醒后，不单独占行

**示例**：
- "遵循 AI Native 设计原则，优先使用语义理解而非硬编码规则 [MEM-ai-native-design]"
- "记忆写入通过显式调用 lingxi-memory 子代理（`/lingxi-memory` 或自然语言提及）在独立上下文中执行，写入前须用户门控确认"

## 输出行为（重要）

- 这些注入信息应该影响你的方案选择、默认约束、风险提示等
- **不要在对外输出中显式声明“我检索了记忆库”**（除非用户明确要求）
- 不要为了“完成注入”而硬塞内容：不相关就不注入

## 失败降级

如果语义搜索不可用或失败：

- 直接降级为无注入继续回答
- 保持静默，不要输出“检索失败”
