---
name: audit
description: 此 Skill 审查 Plan 的技术细节、可行性与风险。当 /flow REQ-xxx 在 plan 完成后、进入 work 前需要反复审查时激活，支持多次循环，产出明确的推进判据与待澄清项（仅输出到对话，不写入）。
---

# Audit

## Outputs

- 审查报告：仅输出到对话（不保存文档）

## Instructions

### 1) 读取输入

- `.workflow/requirements/in-progress/REQ-xxx.md`（需求）
- `.workflow/requirements/in-progress/REQ-xxx.plan.md`（计划）
- 识别需求类型（前端/后端/全栈）

### 2) 审查维度

#### 2.1 技术风险

| 子项 | 检查内容 |
|-----|---------|
| 方案可行性 | 技术方案是否明确、是否有验证过的先例 |
| 依赖稳定性 | 外部依赖版本是否稳定、是否有兼容性风险 |
| 性能风险 | 是否有性能瓶颈、大数据量场景是否考虑 |
| 架构影响 | 是否影响现有架构、是否需要重构 |

#### 2.2 任务完整性

| 子项 | 检查内容 |
|-----|---------|
| 任务拆解 | 是否完整、是否有遗漏步骤 |
| 依赖关系 | 任务顺序是否正确、依赖是否明确 |
| 文件变更 | 是否列出需创建/修改的文件（包含测试文件） |
| 边界条件 | 是否考虑异常情况、错误处理 |
| **测试任务** | 是否有独立的测试任务分类 |

#### 2.3 测试规格审查（强化）

| 子项 | 检查内容 |
|-----|---------|
| 行为提取 | 可测试行为是否从需求中提取（而非凭空发明） |
| 规格完整性 | 测试规格是否包含输入/输出/边界条件 |
| 类型区分 | 是否区分单元测试/集成测试/手工验证的适用场景 |
| 覆盖对齐 | 测试是否覆盖 req 中的所有验收标准 |

#### 2.4 验证可靠性

| 子项 | 检查内容 |
|-----|---------|
| 可复现性 | 验证步骤是否可独立执行 |
| 覆盖充分性 | 是否覆盖正常流程、边界条件、错误处理 |
| 与需求对齐 | 验证方式是否覆盖 req 中的验收标准 |

#### 2.5 规范符合度

| 子项 | 检查内容 |
|-----|---------|
| 规范引用 | 任务是否引用了项目规范（如 `.cursor/rules/`） |
| 命名约定 | 文件/变量/API 命名是否符合项目约定 |
| 架构模式 | 是否遵循项目的架构模式 |

### 3) 按需求类型检查

#### 前端需求

- [ ] UI 状态：是否明确按钮/控件的三态（可见/可用/文案）
- [ ] 用户旅程：入口 → 操作 → 反馈是否清晰
- [ ] 数据依赖：API 字段是否满足 UI 展示需求
- [ ] 加载/错误状态：是否有 loading、error 处理
- [ ] **组件测试**：是否规划了组件单元测试

#### 后端需求

- [ ] API 设计：请求/响应/错误码是否完整
- [ ] 数据模型：表结构、字段约束是否明确
- [ ] 权限/配额：是否考虑权限检查、频率限制
- [ ] 性能考量：是否考虑索引、缓存、分页
- [ ] **服务测试**：是否规划了服务层单元测试

#### 全栈需求

- [ ] 同时满足前后端检查项
- [ ] 数据流：前后端数据交互是否清晰
- [ ] 状态同步：操作后哪些缓存需要更新
- [ ] 集成点：与其他模块的交互点是否明确
- [ ] **集成测试**：是否规划了端到端集成测试

### 4) 常见风险点速查

| 风险点 | 表现 |
|-------|-----|
| 任务遗漏 | 只有"实现"没有"测试"、只有"创建"没有"集成" |
| **测试缺失** | 没有独立的测试任务分类 |
| **规格不全** | 测试规格缺少输入/输出/边界条件定义 |
| **行为发明** | 测试行为不是从需求提取，而是凭空发明 |
| 依赖不明 | 任务间依赖关系不清晰，无法确定执行顺序 |
| 验证模糊 | "测试通过"但没有具体测试用例 |
| 边界遗漏 | 只考虑正常流程，没有错误处理 |
| 规范缺失 | 没有引用项目规范，可能导致风格不一致 |
| 文件不明 | 没有列出需要创建/修改的文件（包含测试文件） |

### 5) 阻塞项处理（Fail Fast）

若发现阻塞项，必须提示用户选择：

- 立即回到 plan 修正（推荐）
- 或继续输出审查报告但标注"不可进入 work"

**测试相关的阻塞项**：

- 没有测试任务分类 → 阻塞
- 可测试行为未提取 → 阻塞
- 测试规格完全缺失 → 阻塞

### 6) 输出结构

```markdown
# Plan 审查报告：<REQ-xxx>

## 1. 技术风险评估

| 维度 | 风险等级 | 说明 |
|-----|---------|-----|
| 方案可行性 | 高/中/低 | ... |
| 依赖稳定性 | 高/中/低 | ... |
| 性能风险 | 高/中/低 | ... |
| 架构影响 | 高/中/低 | ... |

## 2. 测试规格评估（强化）

| 维度 | 状态 | 说明 |
|-----|-----|-----|
| 测试任务分类 | ✅/❌ | 是否有独立的测试任务 |
| 行为提取 | ✅/❌ | 可测试行为是否从需求提取 |
| 规格完整性 | ✅/❌ | 是否包含输入/输出/边界条件 |
| 类型区分 | ✅/❌ | 单元/集成/手工验证是否区分 |

## 3. Plan 完整性分析

### 阻塞项（必须修正，否则无法进入 work）

- ...

### 建议项（强烈建议修正，提升质量）

- ...

### 可选项（锦上添花）

- ...

## 4. 按需求类型检查结果

[根据需求类型输出对应检查项的通过/未通过状态]

## 5. 总体评估

| 指标 | 结果 |
|-----|-----|
| 可执行性评分 | X/5 |
| 是否可进入 work | 是/否 |
| 判断依据 | ... |

**评分标准：**
- 5分：无阻塞项，无建议项，测试规格完整，可直接执行
- 4分：无阻塞项，有少量建议项，测试规格基本完整，可执行
- 3分：无阻塞项，有较多建议项，测试规格需补充，建议修正后执行
- 2分：有阻塞项（含测试缺失），需修正后重新审查
- 1分：有严重阻塞项，需大幅修改 plan

## 6. 下一步（人工闸门）

A) 再 audit 一次
B) 回到 plan 修正
C) 进入 work（需你确认）
```
