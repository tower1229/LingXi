# 设计理念（由价值观驱动）

## 概述

cursor-workflow 的核心目标是：**让 AI workflow 具备"项目级成长能力"**。

这不是一个简单的工具集合，而是一套工程化的知识沉淀与自动化改进系统。它通过机制设计而非模型训练，让 AI 在项目工作中持续积累经验，并将经验提炼为可复用的质量准则。

> 说明：本文描述“理念与设计域”，不作为价值观（核心原则）的 SSoT。
> 价值观（核心原则）请以《[灵犀宪章](./lingxi-charter.md)》为准；分层映射见《[原则阶梯](./principle-ladder.md)》。

## 核心问题

### 为什么需要项目级成长能力？

在使用 AI 辅助开发时，我们经常遇到以下问题：

1. **同类问题反复发生**：同一类坑/风险不断出现，AI 每次都像第一次遇到
2. **判断不稳定**：今天建议 A，明天建议 B，很难形成"这个项目里我们长期相信的判断"
3. **过程知识难沉淀**：排查路径、验证方式、关键取舍只存在于当次对话里
4. **重复任务不变快**：每次会话都从零开始，同样的任务做 100 次所需要的时间差不多

这些问题的根源在于：**AI 缺乏项目级的记忆和判断积累机制**。

### 传统方案的局限

- **硬编码提示词**：难以维护，容易过时，无法适应项目演进
- **会话级上下文**：每次对话都是新的开始，无法积累长期知识
- **人工总结**：依赖人的记忆和主动性，容易遗漏，难以系统化

## 核心理念

### 1. AI Workflow Growth（AI 工作流成长）

**核心思想**：让 AI 在项目工作中持续学习，形成项目级的"判断资产"。

这不是通过训练模型实现的，而是通过**机制设计**：

- **即时捕获**：在工作过程中自动识别可沉淀的判断点
- **分层处理**：区分短期项目记录（session）和长期判断资产（experience）
- **持续治理**：经验会演化（合并、取代），而不是无限堆积
- **质量升级**：从经验中提炼质量准则，形成可执行的约束

**目标**：不是"记得越来越多"，而是"判断越来越准"。

### 2. Context Engineering（上下文工程）

**核心思想**：在正确的时刻给到**最小高信号**信息，避免上下文膨胀导致偏航。

#### 原则

- **指针优先**：先给文件路径、函数名、配置项等指针，按需加载细节
- **分层加载**：按需展开，避免一次性加载所有信息
- **按需展开**：只在需要时加载具体内容，而不是预先加载所有可能相关的信息

#### 实现方式

- **经验索引**：通过 Trigger 匹配，只在相关场景加载对应经验
- **服务上下文**：按需生成服务说明，避免文档膨胀
- **结构化捕获**：使用 EXP-CANDIDATE 结构化捕获高信号判断，而不是长文本叙述

### 3. Compounding Engineering（复合工程）

**核心思想**：让每一单位工作都降低后续工作成本。

#### 知识沉淀与自动化改进

把执行过程中的以下内容沉淀为可检索、可执行的系统资产：

- **缺陷模式**：常见错误、边界情况、异常处理
- **隐性约束**：项目特定的限制、约定、规范
- **排查结论**：问题根因、验证方法、调试技巧
- **决策依据**：为什么选择这个方案、拒绝了哪些备选、关键判断信号

#### 沉淀目标

- **经验库**（`.workflow/context/experience/`）：长期判断资产
- **规则**（`.cursor/rules/qs-*`）：可执行的约束
- **Skills**（`.cursor/skills/`）：可复用的流程能力
- **服务上下文**（`.workflow/context/tech/services/`）：长期可复用的服务说明

#### 自动化改进

- **自动拦截**：将高频错误从"经验"升级为 hook/lint/CI
- **自动提醒**：在相关场景自动加载历史经验
- **自动治理**：合并重复、取代过时，保持经验库精炼

### 4. Human-in-the-Loop（人在回路）

**核心思想**：关键决策点必须有人工确认，保证过程可控。

#### 人工闸门（Human Gates）

- **阶段推进**：阶段切换必须人工确认，不能自动推进
- **经验写入**：未收到 `/flow 沉淀 ...` 明确确认前，不得写入经验库
- **质量准则采纳**：未收到 `/flow 采纳质量准则 ...` 明确确认前，不得写入规则

#### 确认式沉淀（Confirm-only Knowledge Capture）

- **机器负责不漏**：自动收集候选，避免遗漏
- **人负责不滥**：只有明确确认的候选才进入长期知识库

#### 为什么需要人工确认？

- **质量控制**：避免低质量信息污染知识库
- **上下文理解**：人比 AI 更理解项目的长期目标和约束
- **责任归属**：关键决策需要人的明确授权

### 5. Skills-first 设计

**核心思想**：将高质量提示词、模板、检查清单下沉到 Skills，而不是硬编码在主命令中。

#### 为什么选择 Skills？

- **可维护性**：Skills 独立维护，易于更新和扩展
- **可复用性**：Skills 可在不同场景复用
- **可测试性**：Skills 可以独立测试和验证
- **可组合性**：Skills 可以组合使用，形成复杂工作流

#### Skills 的职责

- **阶段 Playbook**：req、plan、audit、work、review、archive 各阶段的执行指南
- **底座能力**：index-manager、plan-manager、experience-index 等基础设施
- **工具能力**：service-loader、context-engineering、rules-creator 等辅助工具

#### 与硬编码提示词的对比

| 维度 | Skills-first | 硬编码提示词 |
|------|-------------|-------------|
| 维护性 | 独立维护，易于更新 | 集中维护，难以更新 |
| 复用性 | 可在不同场景复用 | 绑定特定场景 |
| 扩展性 | 易于扩展新能力 | 需要修改主代码 |
| 测试性 | 可以独立测试 | 难以独立测试 |

## 由价值观推导的设计原则（摘要）

1. **Single Entrypoint**：只用 `/flow` 一个入口，降低认知负担
2. **Human Gates**：关键决策点必须人工确认，保证可控性
3. **Confirm-only Knowledge Capture**：经验写入需要明确确认，保证质量
4. **即时捕获，分层处理**：EXP-CANDIDATE + Subagent 机制，自动收集、人工确认
5. **最小高信号上下文**：指针优先、按需加载，避免上下文膨胀（上下文工程的关键原则）
6. **质量资产化**：质量必须以可维护的资产形态存在，并能随实践演进（载体选择属于工程手段）

## 价值主张

通过这套机制，cursor-workflow 实现了：

- **项目级记忆**：AI 可以记住项目的长期判断和约束
- **持续改进**：经验会演化，质量会提升
- **自动化增强**：高频错误自动拦截，相关经验自动提醒
- **可维护性**：知识库精炼、可追溯、可回滚

**最终目标**：让 AI 成为项目的"资深开发者"，而不是每次都像"新人"。
